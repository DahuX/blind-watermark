"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _numeric=_interopRequireDefault(require("numeric")),_transformArr=_interopRequireDefault(require("./transformArr")),_againGroup=_interopRequireDefault(require("./againGroup"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var nj=require("numjs"),d1=20,d2=6,mixRobust=function(e,r,t){return(Math.floor(e/r)+.25+.5*Number(t))*r},getUSV=function(e){for(var r=_numeric.default.svd(e),t=r.U,a=r.S,n=r.V,u=e.length,i=e[0].length,o=0,d=0,l=function(){if(++d>=i&&(d=0,o++),o>=u)throw new Error("bad matrix case")};a.includes(NaN);){e[o][d]=Math.round(e[o][d]);var f=_numeric.default.svd(e);t=f.U,a=f.S,n=f.V,l()}return{U:t,S:a,V:n}},encode=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=getUSV(e),a=t.U,n=t.S,u=t.V;n[0]=mixRobust(n[0],d1,r),n[1]=mixRobust(n[1],d2,r);var i=nj.dot(a,nj.dot(nj.diag(n),(0,_transformArr.default)(u)));return(0,_againGroup.default)(i.selection.data,i.selection.shape[1])},decode=function decode(matrix){var average=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,avg=eval(matrix.join(",").replaceAll(",","+"))/(matrix.length*matrix[0].length);if(avg>360)return average;var _getUSV2=getUSV(matrix),S=_getUSV2.S,wm0=Number(S[0]%d1>d1/2),wm1=Number(S[1]%d2>d2/2);return(3*wm0+wm1)/4},_default={encode:encode,decode:decode};exports.default=_default;