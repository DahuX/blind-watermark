"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function _createClass(r,e,n){return e&&_defineProperties(r.prototype,e),n&&_defineProperties(r,n),r}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayWithHoles(r){if(Array.isArray(r))return r}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _iterableToArrayLimit(r,e){var n=r&&("undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"]);if(null!=n){var t,i,o=[],u=!0,a=!1;try{for(n=n.call(r);!(u=(t=n.next()).done)&&(o.push(t.value),!e||o.length!==e);u=!0);}catch(r){a=!0,i=r}finally{try{u||null==n.return||n.return()}finally{if(a)throw i}}return o}}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var n=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(n="Object"===n&&r.constructor?r.constructor.name:n)||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var SYMMETRIC_PADDING="symmetric";function symmetricPadding(r,e,n){if(void 0===n&&(n=!1),0===r.length)throw new Error("Cannot determine symmetric padding for data of zero length.");var t=Math.floor(e/r.length);return(n?t:t+1)%2==0?r[e%r.length]:r[r.length-1-e%r.length]}var ANTISYMMETRIC_PADDING="antisymmetric";function antisymmetricPadding(r,e,n){return void 0===n&&(n=!1),(Math.floor(e/r.length)%2==0?-1:1)*symmetricPadding(r,e,n)}var CONSTANT_PADDING="constant";function constantPadding(r,e){if(void 0===e&&(e=!1),0===r.length)throw new Error("Cannot determine constant padding for data of zero length.");return e?r[0]:r[r.length-1]}var PERIODIC_PADDING="periodic";function periodicPadding(r,e,n){if(void 0===n&&(n=!1),0===r.length)throw new Error("Cannot determine periodic padding for data of zero length.");return n?r[r.length-1-e%r.length]:r[e%r.length]}var REFLECT_PADDING="reflect";function reflectPadding(r,e,n){if(void 0===n&&(n=!1),0===r.length)throw new Error("Cannot determine reflect padding for data of zero length.");if(1===r.length)return r[0];var t=Math.floor(e/(r.length-1));return(n?t:t+1)%2==0?r[e%(r.length-1)+1]:r[r.length-2-e%(r.length-1)]}var SMOOTH_PADDING="smooth";function smoothPadding(r,e,n){if(void 0===n&&(n=!1),0===r.length)throw new Error("Cannot determine smooth padding for data of zero length.");var t=r.length-1;return(n?r[0]:r[t])+(e+1)*(n?1===r.length?r[0]:r[0]-r[1]:1===r.length?-r[0]:r[t]-r[t-1])}var ZERO_PADDING="zero";function zeroPadding(){return 0}var PADDING_MODES={antisymmetric:ANTISYMMETRIC_PADDING,constant:CONSTANT_PADDING,periodic:PERIODIC_PADDING,reflect:REFLECT_PADDING,smooth:SMOOTH_PADDING,symmetric:SYMMETRIC_PADDING,zero:ZERO_PADDING,modes:[ZERO_PADDING,CONSTANT_PADDING,SYMMETRIC_PADDING,PERIODIC_PADDING,SMOOTH_PADDING,REFLECT_PADDING,ANTISYMMETRIC_PADDING]},HaarWavelet=[1/Math.SQRT2,1/Math.SQRT2],Db2Wavelet=[(1+Math.sqrt(3))/(4*Math.SQRT2),(3+Math.sqrt(3))/(4*Math.SQRT2),(3-Math.sqrt(3))/(4*Math.SQRT2),(1-Math.sqrt(3))/(4*Math.SQRT2)],Db3Wavelet=[.33267055295008263,.8068915093110925,.45987750211849154,-.13501102001025458,-.08544127388202666,.03522629188570953],Db4Wavelet=[.2303778133088965,.7148465705529157,.6308807679298589,-.027983769416859854,-.18703481171909309,.030841381835560764,.0328830116668852,-.010597401785069032],Db5Wavelet=[.16010239797419293,.6038292697971896,.7243085284377729,.13842814590132074,-.24229488706638203,-.032244869584638375,.07757149384004572,-.006241490212798274,-.012580751999081999,.0033357252854737712],Db6Wavelet=[.11154074335010947,.49462389039845306,.7511339080210954,.31525035170919763,-.22626469396543983,-.12976686756726194,.09750160558732304,.027522865530305727,-.03158203931748603,.0005538422011614961,.004777257510945511,-.0010773010853084796],Db7Wavelet=[.07785205408500918,.3965393194819173,.7291320908462351,.4697822874051931,-.14390600392856498,-.22403618499387498,.07130921926683026,.08061260915108308,-.03802993693501441,-.01657454163066688,.01255099855609984,.0004295779729213665,-.0018016407040474908,.00035371379997452024],Db8Wavelet=[.05441584224310401,.31287159091429995,.6756307362972898,.5853546836542067,-.015829105256349306,-.2840155429615469,.0004724845739132828,.12874742662047847,-.017369301001807547,-.044088253930794755,.013981027917398282,.008746094047405777,-.004870352993451574,-.00039174037337694705,.0006754494064505693,-.00011747678412476953],Db9Wavelet=[.038077947363878345,.24383467461259034,.6048231236901112,.6572880780513005,.13319738582500756,-.2932737832791749,-.09684078322297646,.14854074933810638,.03072568147933338,-.06763282906132997,.00025094711483145197,.022361662123679096,-.004723204757751397,-.00428150368246343,.0018476468830562265,.00023038576352319597,-.0002519631889427101,393473203162716e-19],Db10Wavelet=[.026670057900555554,.1881768000776915,.5272011889317256,.6884590394536035,.2811723436605775,-.24984642432731538,-.19594627437737705,.12736934033579325,.09305736460357235,-.07139414716639708,-.029457536821875813,.033212674059341,.0036065535669561697,-.010733175483330575,.001395351747052901,.001992405295185056,-.0006858566949597116,-.00011646685512928545,9358867032006959e-20,-13264202894521244e-21],ScalingNumbers={db1:HaarWavelet,db2:Db2Wavelet,db3:Db3Wavelet,db4:Db4Wavelet,db5:Db5Wavelet,db6:Db6Wavelet,db7:Db7Wavelet,db8:Db8Wavelet,db9:Db9Wavelet,db10:Db10Wavelet,D2:HaarWavelet,D4:Db2Wavelet,D6:Db3Wavelet,D8:Db4Wavelet,D10:Db5Wavelet,D12:Db6Wavelet,D14:Db7Wavelet,D16:Db8Wavelet,D18:Db9Wavelet,D20:Db10Wavelet,haar:HaarWavelet};function add(r,n){if(r.length!==n.length)throw new Error("Both arrays have to have the same length.");return r.map(function(r,e){return r+n[e]})}function assertValidApproxDetail(r,e){if(r.length!==e.length)throw new Error("Approximation and detail coefficients must have equal length.");if(0===r.length)throw new Error("Approximation and detail coefficients must not have zero length.");return!0}function assertValidCoeffs(r){if(r.length<1)throw new Error("Invalid coefficients. Array length must not be zero.");return!0}function assertValidFilters(r){if(r.high.length!==r.low.length)throw new Error("High-pass and low-pass filters have to have equal length.");if(r.low.length<2)throw new Error("Wavelet filter length has to be larger than or equal to two.");return!0}function basisFromWavelet(r){return"string"!=typeof r?r:waveletFromScalingNumbers(ScalingNumbers[r])}function createArray(r,n){if(void 0===n&&(n=0),!Number.isInteger(r))throw new Error("Length has to be an integer.");if(r<0)throw new Error("Length must not be smaller than zero.");return Array.apply(null,Array(r)).map(function(r,e){return"function"==typeof n?n(e):n})}function dot$1(r,t){if(r.length!==t.length)throw new Error("Both arrays have to have the same length.");return r.reduce(function(r,e,n){return r+e*t[n]},0)}function mulScalar(e,r){return r.map(function(r){return e*r})}function padElement(r,e,n,t){switch(t){case PADDING_MODES.antisymmetric:return antisymmetricPadding(r,e,n);case PADDING_MODES.constant:return constantPadding(r,n);case PADDING_MODES.periodic:return periodicPadding(r,e,n);case PADDING_MODES.reflect:return reflectPadding(r,e,n);case PADDING_MODES.smooth:return smoothPadding(r,e,n);case PADDING_MODES.symmetric:return symmetricPadding(r,e,n);case PADDING_MODES.zero:return zeroPadding();default:throw new Error('Unknown signal extension mode: "'+t+'"')}}function padWidths(r,e){if(r<=0)throw new Error("Cannot determine padding widths for data of length less than or equal to zero.");if(e<2)throw new Error("Cannot determine padding widths for filter of length less than two.");return[e-2,(r+e)%2==0?e-2:e-1]}function waveletFromScalingNumbers(r){if(r.length<2)throw new Error("Scaling numbers length has to be larger than or equal to two.");var e=r.slice().reverse().map(function(r,e){return e%2==0?r:-r});return{dec:{low:r.slice(),high:e.slice()},rec:{low:r.slice(),high:e.slice()}}}var DEFAULT_PADDING_MODE=PADDING_MODES.symmetric,DiscreteWavelets=function(){function r(){}return r.dwt=function(r,e,n){void 0===n&&(n=DEFAULT_PADDING_MODE);var t=basisFromWavelet(e).dec;assertValidFilters(t);var i=t.low.length;r=this.pad(r,padWidths(r.length,i),n);for(var o=[],u=[],a=0;a+i<=r.length;a+=2){var c=r.slice(a,a+i);o.push(dot$1(c,t.low)),u.push(dot$1(c,t.high))}return[o,u]},r.energy=function(r){for(var e=0,n=0,t=r;n<t.length;n++){var i=t[n];e+="number"==typeof i?Math.pow(i,2):this.energy(i)}return e},r.idwt=function(r,e,n){if(void 0===r&&void 0!==e&&(r=createArray(e.length,0)),void 0===e&&void 0!==r&&(e=createArray(r.length,0)),void 0===r||void 0===e)throw new Error("Coefficients must not be undefined.");assertValidApproxDetail(r,e);var t=basisFromWavelet(n).rec;assertValidFilters(t);for(var i=t.low.length,o=r.length,u=createArray(i+2*(o-1),0),a=0;a<o;a++){var c=2*a,f=add(f=u.slice(c,c+i),mulScalar(r[a],t.low));f=add(f,mulScalar(e[a],t.high)),u=u.slice(0,c).concat(f).concat(u.slice(c+f.length))}return u.slice(i-2,u.length-(i-2))},r.maxLevel=function(r,e){if(!Number.isInteger(r))throw new Error("Length of data is not an integer. This is not allowed.");if(r<0)throw new Error("Data length cannot be less than zero.");if(0===r)return 0;e=basisFromWavelet(e).dec.low.length;return Math.max(0,Math.floor(Math.log2(r/(e-1))))},r.pad=function(e,r,n){if(!e)throw new Error("Cannot add padding to empty data.");var t=r[0],r=r[1];return createArray(t,function(r){return padElement(e,t-1-r,!0,n)}).concat(e).concat(createArray(r,function(r){return padElement(e,r,!1,n)}))},r.wavedec=function(r,e,n,t){if(void 0===n&&(n=DEFAULT_PADDING_MODE),(t=void 0===t?this.maxLevel(r.length,e):t)<0)throw new Error("Decomposition level must not be less than zero");for(var i=[],o=r.slice(),u=1;u<=t;u++){var a=this.dwt(o,e,n),o=a[0],a=a[1];i.unshift(a.slice())}return i.unshift(o.slice()),i},r.waverec=function(r,e){assertValidCoeffs(r),e=basisFromWavelet(e);for(var n=r[0],t=1;t<r.length;t++){var i=r[t];n.length===i.length+1&&(n=n.slice(0,n.length-1)),n=this.idwt(n,i,e)}return n.slice()},r.Modes=PADDING_MODES,r}(),dwt=function(r){if(r&&void 0!==r[0]&&void 0!==r[0][0]){var n=[],t=[];return r.forEach(function(r){var e=_slicedToArray(DiscreteWavelets.dwt(r,"haar"),2),r=e[0],e=e[1];n.push(r),t.push(e)}),[n,t]}console.error("private wt need 2d array",r)},idwt=function(r,n){if(r&&n)return r.length!==n.length&&console.error("请输入长度相同且合法的低频、高频分量"),r.map(function(r,e){return DiscreteWavelets.idwt(r,n[e],"haar")});console.error("请输入低频、高频分量",r,n)},privateWt={dwt:dwt,idwt:idwt},click=function(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}},getCanvasDom=function(){var r,e="sherry-chris-b-wm-g-i-c-c",n=document.getElementById(e);return n||((r=document.createElement("canvas")).style.opacity=0,r.style.position="absolute",r.style.left="-999999px",r.id=e,document.body.appendChild(r),n=r),n},getData=function(r){if("img"===(null===(c=r.tagName)||void 0===c?void 0:c.toLowerCase())){if(0!==r.width&&0!==r.height){var e=getCanvasDom();e.width=r.width,e.height=r.height;var n=e.getContext("2d");n.drawImage(r,0,0);var t=n.getImageData(0,0,r.width,r.height),i=t.data,o=t.width,u=t.height,a=[],c=[],e=[],n=[],f=[a,c,e,n];return i.forEach(function(r,e){var n=e%4,t=Math.floor(e/4),e=Math.floor(t/o),t=t%o;f[n][e]||(f[n][e]=[]),f[n][e][t]=r}),{imgData:t,width:o,height:u,R:a,G:c,B:e,A:n}}console.error("请输入有效图片")}else console.error("未传入图片dom",r)},setData=function(r,e){var n=r.R,t=r.G,i=r.B,o=r.A,u=void 0===o?[]:o,a=r.width,o=r.height,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"download",c=n.join(",").split(","),f=t.join(",").split(","),s=i.join(",").split(","),m=u.join(",").split(","),i=getCanvasDom();i.width=a,i.height=o;for(var h,u=i.getContext("2d"),l=u.createImageData(a,o),d=0;d<c.length;d++){var g=4*d;l.data[g]=c[d],l.data[1+g]=f[d],l.data[2+g]=s[d],l.data[3+g]=m[d]||255}u.putImageData(l,0,0),e&&((h=document.createElement("a")).href=i.toDataURL(),h.download=r,setTimeout(function(){window.URL.revokeObjectURL(h.href)},4e4),setTimeout(function(){click(h)},0))},getTwoEnds=function(r){var e=getData(r),n=e.width,t=e.height,i=e.R,o=e.G,r=e.B,e=e.A,u=i.join(",").split(","),a=o.join(",").split(","),c=r.join(",").split(",");return{width:n,height:t,data:e.join(",").split(",").map(function(r,e){return 127.5<Math.max((u[e],a[e],c[e]))})}},setTwoEnds=function(r,e){var n=r.data,t=r.width,r=r.height,n=n.map(function(r){return 255*r});setData({R:n,G:n,B:n,width:t,height:r},!0,e)},imgD={getData:getData,setData:setData,getTwoEnds:getTwoEnds,setTwoEnds:setTwoEnds},againGroup$1=function(){for(var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length?arguments[1]:void 0,n=[],t=0,i=_toConsumableArray(r).length;t<i;t+=e){var o=r.slice(t,t+e);o.length&&n.push(o)}return n},strided4=function(i){for(var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4,r=i[0].length,e=i.length,n=Math.ceil(e/o),r=Math.floor(r/o),e=Math.floor(e/o),u=[],t=0;t<n;t++)!function(r){for(var n=[],e=o*r,t=0;t<o;t++)i[e+t]&&againGroup$1(i[e+t],o).forEach(function(r,e){n[e]||(n[e]=[]),n[e].push(r)});u.push(n)}(t);return{fullRowNun:e,fullColumnNun:r,result:u}},spreadStrided4=function(r){var t=[];return r.forEach(function(r,e){var n=[];r.forEach(function(r,e){r.forEach(function(r,e){n[e]||(n[e]=[]),n[e]=[].concat(_toConsumableArray(n[e]),_toConsumableArray(r))})}),t=[].concat(_toConsumableArray(t),n)}),t},strided={strided4:strided4,spreadStrided4:spreadStrided4},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},numeric1_2_6={};!function(exports){var numeric=exports,IH,JH,KH,MH,NH,OH;function PH(r){var e,n,a=this,t=r.length,i=0,o=a.i=a.j=a.m=0;for(a.S=[],a.c=[],t||(r=[t++]);i<KH;)a.S[i]=i++;for(i=0;i<KH;i++)o=SH(o+(e=a.S[i])+r[i%t]),n=a.S[o],a.S[i]=n,a.S[o]=e;a.g=function(r){var e=a.S,n=SH(a.i+1),t=e[n],i=SH(a.j+t),o=e[i];e[n]=o,e[i]=t;for(var u=e[SH(t+o)];--r;)n=SH(n+1),o=e[i=SH(i+(t=e[n]))],e[n]=o,e[i]=t,u=u*KH+e[SH(t+o)];return a.i=n,a.j=i,u},a.g(KH)}function RH(r,e,n,t){for(r+="",t=n=0;t<r.length;t++)e[SH(t)]=SH((n^=19*e[SH(t)])+r.charCodeAt(t));for(t in r="",e)r+=String.fromCharCode(e[t]);return r}function SH(r){return r&KH-1}function BI(r){if("object"!=typeof r)return r;for(var e=[],n=r.length,t=0;t<n;t++)e[t+1]=BI(r[t]);return e}function CI(r){if("object"!=typeof r)return r;for(var e=[],n=r.length,t=1;t<n;t++)e[t-1]=CI(r[t]);return e}function GI(r,e,n,t,i,o,u,a,c,f,s,m,h,l,d,g){for(var p,v,y,w,x,b,A,M,D,T,_,S,k,j,P,I,N,E,L,C,V,W,H=Math.min(t,f),R=2*t+H*(H+5)/2+2*f+1,q=1e-60;1+.1*(q+=q)<=1||1+.2*q<=1;);for(p=1;p<=t;p+=1)d[p]=e[p];for(p=t+1;p<=R;p+=1)d[p]=0;for(p=1;p<=f;p+=1)m[p]=0;if(w=[],0===g[1]){if(!function(r,e,n){for(var t,i,o,u,a,c=1;c<=e;c+=1){if(a=0,(i=(n[1]=c)-1)<1){if((a=r[c][c]-a)<=0)break;r[c][c]=Math.sqrt(a)}else{for(o=1;o<=i;o+=1){for(u=r[o][c],t=1;t<o;t+=1)u-=r[t][c]*r[t][o];u/=r[o][o],a+=(r[o][c]=u)*u}if((a=r[c][c]-a)<=0)break;r[c][c]=Math.sqrt(a)}n[1]=0}}(r,t,w),0!==w[1])return void(g[1]=2);!function(r,e,n){for(var t,i,o,u=1;u<=e;u+=1){for(o=0,t=1;t<u;t+=1)o+=r[t][u]*n[t];n[u]=(n[u]-o)/r[u][u]}for(i=1;i<=e;i+=1)for(n[u=e+1-i]=n[u]/r[u][u],o=-n[u],t=1;t<u;t+=1)n[t]=n[t]+o*r[t][u]}(r,t,e),function(r,e){for(var n,t,i,o,u=1;u<=e;u+=1){for(r[u][u]=1/r[u][u],o=-r[u][u],n=1;n<u;n+=1)r[n][u]=o*r[n][u];if(e<(i=u+1))break;for(t=i;t<=e;t+=1)for(o=r[u][t],r[u][t]=0,n=1;n<=u;n+=1)r[n][t]=r[n][t]+o*r[n][u]}}(r,t)}else{for(v=1;v<=t;v+=1)for(i[v]=0,p=1;p<=v;p+=1)i[v]=i[v]+r[p][v]*e[p];for(v=1;v<=t;v+=1)for(e[v]=0,p=v;p<=t;p+=1)e[v]=e[v]+r[v][p]*i[p]}for(o[1]=0,v=1;v<=t;v+=1)for(i[v]=e[v],o[1]=o[1]+d[v]*i[v],d[v]=0,p=v+1;p<=t;p+=1)r[p][v]=0;for(o[1]=-o[1]/2,g[1]=0,S=(D=(M=(T=(A=(b=t)+t)+H)+H+1)+H*(H+1)/2)+f,p=1;p<=f;p+=1){for(j=0,v=1;v<=t;v+=1)j+=u[v][p]*u[v][p];d[S+p]=Math.sqrt(j)}function O(){d[T+h]=d[T+h+1],d[T+h+1]=0,m[h]=0,h-=1,l[2]=l[2]+1}for(l[1]=h=0,l[2]=0;;){if(999===function(){for(l[1]=l[1]+1,R=D,p=1;p<=f;p+=1){for(R+=1,j=-a[p],v=1;v<=t;v+=1)j+=u[v][p]*i[v];if(Math.abs(j)<q&&(j=0),s<p)d[R]=j;else if(d[R]=-Math.abs(j),0<j){for(v=1;v<=t;v+=1)u[v][p]=-u[v][p];a[p]=-a[p]}}for(p=1;p<=h;p+=1)d[D+m[p]]=0;for(k=_=0,p=1;p<=f;p+=1)d[D+p]<k*d[S+p]&&(k=d[D+(_=p)]/d[S+p]);return 0===_?999:0}())return;for(;0!==(W=function(){for(p=1;p<=t;p+=1){for(j=0,v=1;v<=t;v+=1)j+=r[v][p]*u[v][_];d[p]=j}for(y=b,p=1;p<=t;p+=1)d[y+p]=0;for(v=h+1;v<=t;v+=1)for(p=1;p<=t;p+=1)d[y+p]=d[y+p]+r[p][v]*d[v];for(C=!0,p=h;1<=p;p-=1){for(j=d[p],y=(R=M+p*(p+3)/2)-p,v=p+1;v<=h;v+=1)j-=d[R]*d[A+v],R+=v;if(j/=d[y],d[A+p]=j,m[p]<s)break;if(j<0)break;C=!1,x=p}if(!C)for(P=d[T+x]/d[A+x],p=1;p<=h&&!(m[p]<s)&&!(d[A+p]<0);p+=1)(k=d[T+p]/d[A+p])<P&&(P=k,x=p);for(j=0,p=b+1;p<=b+t;p+=1)j+=d[p]*d[p];if(Math.abs(j)<=q){if(C)return g[1]=1,999;for(p=1;p<=h;p+=1)d[T+p]=d[T+p]-P*d[A+p];return d[T+h+1]=d[T+h+1]+P,700}for(j=0,p=1;p<=t;p+=1)j+=d[b+p]*u[p][_];for(I=-d[D+_]/j,V=!0,C||P<I&&(I=P,V=!1),p=1;p<=t;p+=1)i[p]=i[p]+I*d[b+p],Math.abs(i[p])<q&&(i[p]=0);for(o[1]=o[1]+I*j*(I/2+d[T+h+1]),p=1;p<=h;p+=1)d[T+p]=d[T+p]-I*d[A+p];if(d[T+h+1]=d[T+h+1]+I,!V){for(j=-a[_],v=1;v<=t;v+=1)j+=i[v]*u[v][_];if(s<_)d[D+_]=j;else if(d[D+_]=-Math.abs(j),0<j){for(v=1;v<=t;v+=1)u[v][_]=-u[v][_];a[_]=-a[_]}return 700}for(m[h+=1]=_,R=M+(h-1)*h/2+1,p=1;p<=h-1;p+=1)d[R]=d[p],R+=1;if(h===t)d[R]=d[t];else{for(p=t;h+1<=p&&0!==d[p]&&(N=Math.max(Math.abs(d[p-1]),Math.abs(d[p])),E=Math.min(Math.abs(d[p-1]),Math.abs(d[p])),k=0<=d[p-1]?Math.abs(N*Math.sqrt(1+E*E/(N*N))):-Math.abs(N*Math.sqrt(1+E*E/(N*N))),N=d[p-1]/k,E=d[p]/k,1!==N);p-=1)if(0===N)for(d[p-1]=E*k,v=1;v<=t;v+=1)k=r[v][p-1],r[v][p-1]=r[v][p],r[v][p]=k;else for(d[p-1]=k,L=E/(1+N),v=1;v<=t;v+=1)k=N*r[v][p-1]+E*r[v][p],r[v][p]=L*(r[v][p-1]+k)-r[v][p],r[v][p-1]=k;d[R]=d[h]}return 0}());){if(999===W)return;if(700===W)if(x===h)O();else{for(;function(){if(0===d[y=(R=M+x*(x+1)/2+1)+x])return;if(N=Math.max(Math.abs(d[y-1]),Math.abs(d[y])),E=Math.min(Math.abs(d[y-1]),Math.abs(d[y])),k=0<=d[y-1]?Math.abs(N*Math.sqrt(1+E*E/(N*N))):-Math.abs(N*Math.sqrt(1+E*E/(N*N))),N=d[y-1]/k,E=d[y]/k,1===N)return;if(0===N){for(p=x+1;p<=h;p+=1)k=d[y-1],d[y-1]=d[y],d[y]=k,y+=p;for(p=1;p<=t;p+=1)k=r[p][x],r[p][x]=r[p][x+1],r[p][x+1]=k}else{for(L=E/(1+N),p=x+1;p<=h;p+=1)k=N*d[y-1]+E*d[y],d[y]=L*(d[y-1]+k)-d[y],d[y-1]=k,y+=p;for(p=1;p<=t;p+=1)k=N*r[p][x]+E*r[p][x+1],r[p][x+1]=L*(r[p][x]+k)-r[p][x+1],r[p][x]=k}}(),797===function(){for(y=R-x,p=1;p<=x;p+=1)d[y]=d[R],R+=1,y+=1;return d[T+x]=d[T+x+1],m[x]=m[x+1],(x+=1)<h?797:0}(););O()}}}}void 0!==commonjsGlobal&&(commonjsGlobal.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(r,e){var n,t,i;for(void 0===e&&(e=15),t=.5,n=new Date;;){for(i=t*=2;3<i;i-=4)r(),r(),r(),r();for(;0<i;)r(),i--;if(e<new Date-n)break}for(i=t;3<i;i-=4)r(),r(),r(),r();for(;0<i;)r(),i--;return 1e3*(3*t-1)/(new Date-n)},numeric._myIndexOf=function(r){for(var e=this.length,n=0;n<e;++n)if(this[n]===r)return n;return-1},numeric.myIndexOf=Array.prototype.indexOf||numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(r){var c=[];return function r(e){if(void 0===e)return c.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof e)return c.push('"'+e+'"'),!1;if("boolean"==typeof e)return c.push(e.toString()),!1;if("number"==typeof e){for(var n=function r(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+r(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),t=e/Math.pow(10,n),e=t.toPrecision(numeric.precision);return 10===parseFloat(e)&&(n++,e=(t=1).toPrecision(numeric.precision)),parseFloat(e).toString()+"e"+n.toString()}return"Infinity"}(e),t=e.toPrecision(numeric.precision),i=parseFloat(e.toString()).toString(),o=[n,t,i,parseFloat(t).toString(),parseFloat(i).toString()],u=1;u<o.length;u++)o[u].length<n.length&&(n=o[u]);return c.push(Array(numeric.precision+8-n.length).join(" ")+n),!1}if(null===e)return c.push("null"),!1;if("function"==typeof e){c.push(e.toString());var a=!1;for(u in e)e.hasOwnProperty(u)&&(a?c.push(",\n"):c.push("\n{"),a=!0,c.push(u),c.push(": \n"),r(e[u]));return a&&c.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return c.push("...Large Array..."),!0;for(a=!1,c.push("["),u=0;u<e.length;u++)0<u&&(c.push(","),a&&c.push("\n ")),a=r(e[u]);return c.push("]"),!0}c.push("{");a=!1;for(u in e)e.hasOwnProperty(u)&&(a&&c.push(",\n"),a=!0,c.push(u),c.push(": \n"),r(e[u]));return c.push("}"),!0}(r),c.join("")},numeric.parseDate=function(r){return function r(e){if("string"==typeof e)return Date.parse(e.replace(/-/g,"/"));if(!(e instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");for(var n=[],t=0;t<e.length;t++)n[t]=r(e[t]);return n}(r)},numeric.parseFloat=function(r){return function r(e){if("string"==typeof e)return parseFloat(e);if(!(e instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");for(var n=[],t=0;t<e.length;t++)n[t]=r(e[t]);return n}(r)},numeric.parseCSV=function(r){for(var e,n,t=r.split("\n"),i=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,u=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,a=0,c=0;c<t.length;c++){var f,s=(t[c]+",").match(o);if(0<s.length){for(i[a]=[],e=0;e<s.length;e++)f=(n=s[e]).substr(0,n.length-1),u.test(f)?i[a][e]=parseFloat(f):i[a][e]=f;a++}}return i},numeric.toCSV=function(r){var e,n,t,i,o=numeric.dim(r),u=o[0];for(o[1],i=[],e=0;e<u;e++){for(t=[],n=0;n<u;n++)t[n]=r[e][n].toString();i[e]=t.join(", ")}return i.join("\n")+"\n"},numeric.getURL=function(r){var e=new XMLHttpRequest;return e.open("GET",r,!1),e.send(),e},numeric.imageURL=function(r){function e(r,e,n){void 0===n&&(n=r.length);var t,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1;for(r.length,t=e=void 0===e?0:e;t<n;t++)o=o>>>8^i[255&(o^r[t])];return-1^o}var n,t,i,o,u,a,c,f,s=r[0].length,m=r[0][0].length,h=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,m>>24&255,m>>16&255,m>>8&255,255&m,s>>24&255,s>>16&255,s>>8&255,255&s,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29],l=e(h,12,29);for(h[29]=l>>24&255,h[30]=l>>16&255,h[31]=l>>8&255,h[32]=255&l,n=1,a=t=0;a<s;a++){for(a<s-1?h.push(0):h.push(1),u=3*m+1+(0===a)>>8&255,h.push(o=3*m+1+(0===a)&255),h.push(u),h.push(255&~o),h.push(255&~u),0===a&&h.push(0),c=0;c<m;c++)for(i=0;i<3;i++)t=(t+(n=(n+(o=255<(o=r[i][a][c])?255:o<0?0:Math.round(o)))%65521))%65521,h.push(o);h.push(0)}return h.push((f=(t<<16)+n)>>24&255),h.push(f>>16&255),h.push(f>>8&255),h.push(255&f),f=h.length-41,h[33]=f>>24&255,h[34]=f>>16&255,h[35]=f>>8&255,h[36]=255&f,l=e(h,37),h.push(l>>24&255),h.push(l>>16&255),h.push(l>>8&255),h.push(255&l),h.push(0),h.push(0),h.push(0),h.push(0),h.push(73),h.push(69),h.push(78),h.push(68),h.push(174),h.push(66),h.push(96),h.push(130),"data:image/png;base64,"+function(r){for(var e,n,t,i,o=r.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",c=0;c<o;c+=3)n=((3&(e=r[c]))<<4)+((t=r[c+1])>>4),t=((15&t)<<2)+((i=r[c+2])>>6),i=63&i,o<=c+1?t=i=64:o<=c+2&&(i=64),a+=u.charAt(e>>2)+u.charAt(n)+u.charAt(t)+u.charAt(i);return a}(h)},numeric._dim=function(r){for(var e=[];"object"==typeof r;)e.push(r.length),r=r[0];return e},numeric.dim=function(r){var e;return"object"==typeof r?"object"==typeof(e=r[0])?"object"==typeof e[0]?numeric._dim(r):[r.length,e.length]:[r.length]:[]},numeric.mapreduce=function(r,e){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+e+';\nif(typeof x === "number") { var xi = x; '+r+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+r+";\n    xi = x[i-1];\n    "+r+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+r+"\n}\nreturn accum;")},numeric.mapreduce2=function(r,e){return Function("x","var n = x.length;\nvar i,xi;\n"+e+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+r+";\n}\nreturn accum;")},numeric.same=function r(e,n){var t,i;if(!(e instanceof Array&&n instanceof Array))return!1;if((i=e.length)!==n.length)return!1;for(t=0;t<i;t++)if(e[t]!==n[t]){if("object"!=typeof e[t])return!1;if(!r(e[t],n[t]))return!1}return!0},numeric.rep=function(r,e,n){var t,i=r[n=void 0===n?0:n],o=Array(i);if(n===r.length-1){for(t=i-2;0<=t;t-=2)o[t+1]=e,o[t]=e;return-1===t&&(o[0]=e),o}for(t=i-1;0<=t;t--)o[t]=numeric.rep(r,e,n+1);return o},numeric.dotMMsmall=function(r,e){for(var n,t,i,o,u,a,c=r.length,f=e.length,s=e[0].length,m=Array(c),h=c-1;0<=h;h--){for(i=Array(s),o=r[h],t=s-1;0<=t;t--){for(u=o[f-1]*e[f-1][t],n=f-2;1<=n;n-=2)u+=o[n]*e[n][t]+o[a=n-1]*e[a][t];0===n&&(u+=o[0]*e[0][t]),i[t]=u}m[h]=i}return m},numeric._getCol=function(r,e,n){for(var t=r.length-1;0<t;--t)n[t]=r[t][e],n[--t]=r[t][e];0===t&&(n[0]=r[0][e])},numeric.dotMMbig=function(r,e){var n,t,i,o=numeric._getCol,u=e.length,a=Array(u),c=r.length,f=e[0].length,s=new Array(c),m=numeric.dotVV;for(t=--c;-1!==t;--t)s[t]=Array(f);for(t=--f;-1!==t;--t)for(o(e,t,a),i=c;-1!==i;--i)n=r[i],s[i][t]=m(n,a);return s},numeric.dotMV=function(r,e){var n=r.length;e.length;for(var t=Array(n),i=numeric.dotVV,o=n-1;0<=o;o--)t[o]=i(r[o],e);return t},numeric.dotVM=function(r,e){for(var n,t,i,o=r.length,u=e[0].length,a=Array(u),c=u-1;0<=c;c--){for(t=r[o-1]*e[o-1][c],n=o-2;1<=n;n-=2)t+=r[n]*e[n][c]+r[i=n-1]*e[i][c];0===n&&(t+=r[0]*e[0][c]),a[c]=t}return a},numeric.dotVV=function(r,e){for(var n,t=r.length,i=r[t-1]*e[t-1],o=t-2;1<=o;o-=2)i+=r[o]*e[o]+r[n=o-1]*e[n];return 0===o&&(i+=r[0]*e[0]),i},numeric.dot=function(r,e){var n=numeric.dim;switch(1e3*n(r).length+n(e).length){case 2002:return e.length<10?numeric.dotMMsmall(r,e):numeric.dotMMbig(r,e);case 2001:return numeric.dotMV(r,e);case 1002:return numeric.dotVM(r,e);case 1001:return numeric.dotVV(r,e);case 1e3:return numeric.mulVS(r,e);case 1:return numeric.mulSV(r,e);case 0:return r*e;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(r){for(var e,n,t,i=r.length,o=Array(i),u=i-1;0<=u;u--){for(t=Array(i),e=u+2,n=i-1;e<=n;n-=2)t[n]=0,t[n-1]=0;for(u<n&&(t[n]=0),t[u]=r[u],n=u-1;1<=n;n-=2)t[n]=0,t[n-1]=0;0===n&&(t[0]=0),o[u]=t}return o},numeric.getDiag=function(r){for(var e=Math.min(r.length,r[0].length),n=Array(e),t=e-1;1<=t;--t)n[t]=r[t][t],n[--t]=r[t][t];return 0===t&&(n[0]=r[0][0]),n},numeric.identity=function(r){return numeric.diag(numeric.rep([r],1))},numeric.pointwise=function(r,e,n){void 0===n&&(n="");for(var t,i=[],o=/\[i\]$/,u="",a=!1,c=0;c<r.length;c++)o.test(r[c])?u=t=r[c].substring(0,r[c].length-3):t=r[c],"ret"===t&&(a=!0),i.push(t);return i[r.length]="_s",i[r.length+1]="_k",i[r.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+u+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(a?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+r.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+e+"\n}\nreturn ret;",Function.apply(null,i)},numeric.pointwise2=function(r,e,n){void 0===n&&(n="");for(var t,i=[],o=/\[i\]$/,u="",a=!1,c=0;c<r.length;c++)o.test(r[c])?u=t=r[c].substring(0,r[c].length-3):t=r[c],"ret"===t&&(a=!0),i.push(t);return i[r.length]="var _n = "+u+".length;\nvar i"+(a?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+e+"\n}\nreturn ret;",Function.apply(null,i)},numeric._biforeach=function r(e,n,t,i,o){if(i!==t.length-1)for(var u=t[i]-1;0<=u;u--)r("object"==typeof e?e[u]:e,"object"==typeof n?n[u]:n,t,i+1,o);else o(e,n)},numeric._biforeach2=function r(e,n,t,i,o){if(i===t.length-1)return o(e,n);for(var u=t[i],a=Array(u),c=u-1;0<=c;--c)a[c]=r("object"==typeof e?e[c]:e,"object"==typeof n?n[c]:n,t,i+1,o);return a},numeric._foreach=function r(e,n,t,i){if(t!==n.length-1)for(var o=n[t]-1;0<=o;o--)r(e[o],n,t+1,i);else i(e)},numeric._foreach2=function r(e,n,t,i){if(t===n.length-1)return i(e);for(var o=n[t],u=Array(o),a=o-1;0<=a;a--)u[a]=r(e[a],n,t+1,i);return u},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){for(var t,r,e,n,i=0;i<numeric.mathfuns2.length;++i)t=numeric.mathfuns2[i],numeric.ops2[t]=t;for(i in numeric.ops2)numeric.ops2.hasOwnProperty(i)&&(t=numeric.ops2[i],e="",n=-1!==numeric.myIndexOf.call(numeric.mathfuns2,i)?(e="var "+t+" = Math."+t+";\n",r=function(r,e,n){return r+" = "+t+"("+e+","+n+")"},function(r,e){return r+" = "+t+"("+r+","+e+")"}):(r=function(r,e,n){return r+" = "+e+" "+t+" "+n},numeric.opseq.hasOwnProperty(i+"eq")?function(r,e){return r+" "+t+"= "+e}:function(r,e){return r+" = "+r+" "+t+" "+e}),numeric[i+"VV"]=numeric.pointwise2(["x[i]","y[i]"],r("ret[i]","x[i]","y[i]"),e),numeric[i+"SV"]=numeric.pointwise2(["x","y[i]"],r("ret[i]","x","y[i]"),e),numeric[i+"VS"]=numeric.pointwise2(["x[i]","y"],r("ret[i]","x[i]","y"),e),numeric[i]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+i+"VV, VS = numeric."+i+"VS, SV = numeric."+i+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+n("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[i],numeric[i+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],n("ret[i]","x[i]"),e),numeric[i+"eqS"]=numeric.pointwise2(["ret[i]","x"],n("ret[i]","x"),e),numeric[i+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+i+"eqV, S = numeric."+i+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n'));for(i=0;i<numeric.mathfuns2.length;++i)t=numeric.mathfuns2[i],delete numeric.ops2[t];for(i=0;i<numeric.mathfuns.length;++i)t=numeric.mathfuns[i],numeric.ops1[t]=t;for(i in numeric.ops1)numeric.ops1.hasOwnProperty(i)&&(e="",t=numeric.ops1[i],-1!==numeric.myIndexOf.call(numeric.mathfuns,i)&&Math.hasOwnProperty(t)&&(e="var "+t+" = Math."+t+";\n"),numeric[i+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",e),numeric[i+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+i+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[i+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",e),numeric[i]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+i+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(i=0;i<numeric.mathfuns.length;++i)t=numeric.mathfuns[i],delete numeric.ops1[t];for(i in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(i)&&(t=numeric.mapreducers[i],numeric[i+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[i]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+i+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(r,e){return"object"==typeof r?"object"==typeof e?numeric.truncVV(r,e):numeric.truncVS(r,e):"object"==typeof e?numeric.truncSV(r,e):Math.round(r/e)*e},numeric.inv=function(r){for(var e,n,t,i,o,u=numeric.dim(r),a=Math.abs,c=u[0],f=u[1],s=numeric.clone(r),m=numeric.identity(c),h=0;h<f;++h){for(var l=-1,d=-1,g=h;g!==c;++g)d<(o=a(s[g][h]))&&(l=g,d=o);for(n=s[l],s[l]=s[h],s[h]=n,i=m[l],m[l]=m[h],m[h]=i,r=n[h],o=h;o!==f;++o)n[o]/=r;for(o=f-1;-1!==o;--o)i[o]/=r;for(g=c-1;-1!==g;--g)if(g!==h){for(e=s[g],t=m[g],r=e[h],o=h+1;o!==f;++o)e[o]-=n[o]*r;for(o=f-1;0<o;--o)t[o]-=i[o]*r,t[--o]-=i[o]*r;0===o&&(t[0]-=i[0]*r)}}return m},numeric.det=function(r){var e=numeric.dim(r);if(2!==e.length||e[0]!==e[1])throw new Error("numeric: det() only works on square matrices");for(var n,t,i,o,u,a,c,f=e[0],s=1,m=numeric.clone(r),h=0;h<f-1;h++){for(n=(t=h)+1;n<f;n++)Math.abs(m[n][h])>Math.abs(m[t][h])&&(t=n);for(t!==h&&(a=m[t],m[t]=m[h],m[h]=a,s*=-1),i=m[h],n=h+1;n<f;n++){for(u=(o=m[n])[h]/i[h],t=h+1;t<f-1;t+=2)c=t+1,o[t]-=i[t]*u,o[c]-=i[c]*u;t!==f&&(o[t]-=i[t]*u)}if(0===i[h])return 0;s*=i[h]}return s*m[h][h]},numeric.transpose=function(r){for(var e,n,t,i,o=r.length,u=r[0].length,a=Array(u),c=0;c<u;c++)a[c]=Array(o);for(e=o-1;1<=e;e-=2){for(t=r[e],n=r[e-1],c=u-1;1<=c;--c)(i=a[c])[e]=t[c],i[e-1]=n[c],(i=a[--c])[e]=t[c],i[e-1]=n[c];0===c&&((i=a[0])[e]=t[0],i[e-1]=n[0])}if(0===e){for(n=r[0],c=u-1;1<=c;--c)a[c][0]=n[c],a[--c][0]=n[c];0===c&&(a[0][0]=n[0])}return a},numeric.negtranspose=function(r){for(var e,n,t,i,o=r.length,u=r[0].length,a=Array(u),c=0;c<u;c++)a[c]=Array(o);for(e=o-1;1<=e;e-=2){for(t=r[e],n=r[e-1],c=u-1;1<=c;--c)(i=a[c])[e]=-t[c],i[e-1]=-n[c],(i=a[--c])[e]=-t[c],i[e-1]=-n[c];0===c&&((i=a[0])[e]=-t[0],i[e-1]=-n[0])}if(0===e){for(n=r[0],c=u-1;1<=c;--c)a[c][0]=-n[c],a[--c][0]=-n[c];0===c&&(a[0][0]=-n[0])}return a},numeric._random=function r(e,n){var t,i,o=e[n],u=Array(o);if(n===e.length-1){for(i=Math.random,t=o-1;1<=t;t-=2)u[t]=i(),u[t-1]=i();return 0===t&&(u[0]=i()),u}for(t=o-1;0<=t;t--)u[t]=r(e,n+1);return u},numeric.random=function(r){return numeric._random(r,0)},numeric.norm2=function(r){return Math.sqrt(numeric.norm2Squared(r))},numeric.linspace=function(r,e,n){if((n=void 0===n?Math.max(Math.round(e-r)+1,1):n)<2)return 1===n?[r]:[];for(var t=Array(n),i=--n;0<=i;i--)t[i]=(i*e+(n-i)*r)/n;return t},numeric.getBlock=function(r,a,c){var f=numeric.dim(r);return function r(e,n){var t,i=a[n],o=c[n]-i,u=Array(o);if(n===f.length-1){for(t=o;0<=t;t--)u[t]=e[t+i];return u}for(t=o;0<=t;t--)u[t]=r(e[t+i],n+1);return u}(r,0)},numeric.setBlock=function(r,a,c,e){var f=numeric.dim(r);return function r(e,n,t){var i,o=a[t],u=c[t]-o;if(t===f.length-1)for(i=u;0<=i;i--)e[i+o]=n[i];for(i=u;0<=i;i--)r(e[i+o],n[i],t+1)}(r,e,0),r},numeric.getRange=function(r,e,n){for(var t,i,o,u=e.length,a=n.length,c=Array(u),f=u-1;-1!==f;--f)for(c[f]=Array(a),i=c[f],o=r[e[f]],t=a-1;-1!==t;--t)i[t]=o[n[t]];return c},numeric.blockMatrix=function(r){var e=numeric.dim(r);if(e.length<4)return numeric.blockMatrix([r]);for(var n,t,i=e[0],o=e[1],u=0,a=0,c=0;c<i;++c)u+=r[c][0].length;for(n=0;n<o;++n)a+=r[0][n][0].length;var f=Array(u);for(c=0;c<u;++c)f[c]=Array(a);var s,m,h,l,d,g=0;for(c=0;c<i;++c){for(s=a,n=o-1;-1!==n;--n)for(s-=(t=r[c][n])[0].length,h=t.length-1;-1!==h;--h)for(d=t[h],m=f[g+h],l=d.length-1;-1!==l;--l)m[s+l]=d[l];g+=r[c][0].length}return f},numeric.tensor=function(r,e){if("number"==typeof r||"number"==typeof e)return numeric.mul(r,e);var n=numeric.dim(r),t=numeric.dim(e);if(1!==n.length||1!==t.length)throw new Error("numeric: tensor product is only defined for vectors");for(var i,o,u,n=n[0],a=t[0],c=Array(n),f=n-1;0<=f;f--){for(i=Array(a),u=r[f],o=a-1;3<=o;--o)i[o]=u*e[o],i[--o]=u*e[o],i[--o]=u*e[o],i[--o]=u*e[o];for(;0<=o;)i[o]=u*e[o],--o;c[f]=i}return c},numeric.T=function(r,e){this.x=r,this.y=e},numeric.t=function(r,e){return new numeric.T(r,e)},numeric.Tbinop=function(r,e,n,t,i){if(numeric.indexOf,"string"!=typeof i)for(var o in i="",numeric)numeric.hasOwnProperty(o)&&(0<=r.indexOf(o)||0<=e.indexOf(o)||0<=n.indexOf(o)||0<=t.indexOf(o))&&1<o.length&&(i+="var "+o+" = numeric."+o+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+t+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+e+");\n}\nreturn new numeric.T("+r+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var r=numeric.mul,e=numeric.div;if(this.y){r=numeric.add(r(this.x,this.x),r(this.y,this.y));return new numeric.T(e(this.x,r),e(numeric.neg(this.y),r))}return new T(e(1,this.x))},numeric.T.prototype.div=function(r){if((r=!(r instanceof numeric.T)?new numeric.T(r):r).y)return this.mul(r.reciprocal());var e=numeric.div;return this.y?new numeric.T(e(this.x,r.x),e(this.y,r.x)):new numeric.T(e(this.x,r.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var r=numeric.transpose,e=this.x,n=this.y;return n?new numeric.T(r(e),r(n)):new numeric.T(r(e))},numeric.T.prototype.transjugate=function(){var r=numeric.transpose,e=this.x,n=this.y;return n?new numeric.T(r(e),numeric.negtranspose(n)):new numeric.T(r(e))},numeric.Tunop=function(r,e,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+e+";\n}\n"+r+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var r=this;if(void 0===r.y)return new numeric.T(numeric.inv(r.x));var e,n,t,i,o,u,a,c,f,s,m,h,l,d,g,p,v,y,w=r.x.length,x=numeric.identity(w),b=numeric.rep([w,w],0),A=numeric.clone(r.x),M=numeric.clone(r.y);for(f=0;f<w;f++){for(h=(d=A[f][f])*d+(g=M[f][f])*g,s=(m=f)+1;s<w;s++)h<(l=(d=A[s][f])*d+(g=M[s][f])*g)&&(m=s,h=l);for(m!==f&&(y=A[f],A[f]=A[m],A[m]=y,y=M[f],M[f]=M[m],M[m]=y,y=x[f],x[f]=x[m],x[m]=y,y=b[f],b[f]=b[m],b[m]=y),e=A[f],n=M[f],o=x[f],u=b[f],d=e[f],g=n[f],s=f+1;s<w;s++)p=e[s],v=n[s],e[s]=(p*d+v*g)/h,n[s]=(v*d-p*g)/h;for(s=0;s<w;s++)p=o[s],v=u[s],o[s]=(p*d+v*g)/h,u[s]=(v*d-p*g)/h;for(s=f+1;s<w;s++){for(t=A[s],i=M[s],a=x[s],c=b[s],d=t[f],g=i[f],m=f+1;m<w;m++)p=e[m],v=n[m],t[m]-=p*d-v*g,i[m]-=v*d+p*g;for(m=0;m<w;m++)p=o[m],v=u[m],a[m]-=p*d-v*g,c[m]-=v*d+p*g}}for(f=w-1;0<f;f--)for(o=x[f],u=b[f],s=f-1;0<=s;s--)for(a=x[s],c=b[s],d=A[s][f],g=M[s][f],m=w-1;0<=m;m--)p=o[m],v=u[m],a[m]-=d*p-g*v,c[m]-=d*v+g*p;return new numeric.T(x,b)},numeric.T.prototype.get=function(r){var e,n=this.x,t=this.y,i=0,o=r.length;if(t){for(;i<o;)n=n[e=r[i]],t=t[e],i++;return new numeric.T(n,t)}for(;i<o;)n=n[e=r[i]],i++;return new numeric.T(n)},numeric.T.prototype.set=function(r,e){var n,t=this.x,i=this.y,o=0,u=r.length,a=e.x,e=e.y;if(0===u)return e?this.y=e:i&&(this.y=void 0),this.x=t,this;if(e){for(i||(i=numeric.rep(numeric.dim(t),0),this.y=i);o<u-1;)t=t[n=r[o]],i=i[n],o++;return t[n=r[o]]=a,i[n]=e,this}if(i){for(;o<u-1;)t=t[n=r[o]],i=i[n],o++;return(t[n=r[o]]=a)instanceof Array?i[n]=numeric.rep(numeric.dim(a),0):i[n]=0,this}for(;o<u-1;)t=t[n=r[o]],o++;return t[n=r[o]]=a,this},numeric.T.prototype.getRows=function(r,e){for(var n,t=e-r+1,i=Array(t),o=this.x,u=this.y,a=r;a<=e;a++)i[a-r]=o[a];if(u){for(n=Array(t),a=r;a<=e;a++)n[a-r]=u[a];return new numeric.T(i,n)}return new numeric.T(i)},numeric.T.prototype.setRows=function(r,e,n){for(var t=this.x,i=this.y,o=n.x,u=n.y,a=r;a<=e;a++)t[a]=o[a-r];if(u)for(i||(i=numeric.rep(numeric.dim(t),0),this.y=i),a=r;a<=e;a++)i[a]=u[a-r];else if(i)for(a=r;a<=e;a++)i[a]=numeric.rep([o[a-r].length],0);return this},numeric.T.prototype.getRow=function(r){var e=this.x,n=this.y;return n?new numeric.T(e[r],n[r]):new numeric.T(e[r])},numeric.T.prototype.setRow=function(r,e){var n=this.x,t=this.y,i=e.x,e=e.y;return n[r]=i,e?(t||(t=numeric.rep(numeric.dim(n),0),this.y=t),t[r]=e):t=t&&numeric.rep([i.length],0),this},numeric.T.prototype.getBlock=function(r,e){var n=this.x,t=this.y,i=numeric.getBlock;return t?new numeric.T(i(n,r,e),i(t,r,e)):new numeric.T(i(n,r,e))},numeric.T.prototype.setBlock=function(r,e,n){n instanceof numeric.T||(n=new numeric.T(n));var t=this.x,i=this.y,o=numeric.setBlock,u=n.x,n=n.y;if(n)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(t,r,e,u),o(i,r,e,n),this;o(t,r,e,u),i&&o(i,r,e,numeric.rep(numeric.dim(u),0))},numeric.T.rep=function(r,e){var n=numeric.T,t=(e=!(e instanceof n)?new n(e):e).x,i=e.y,e=numeric.rep;return i?new n(e(r,t),e(r,i)):new n(e(r,t))},numeric.T.diag=function(r){var e=(r=!(r instanceof numeric.T)?new numeric.T(r):r).x,r=r.y,n=numeric.diag;return r?new numeric.T(n(e),n(r)):new numeric.T(n(e))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(r){return new numeric.T(numeric.identity(r))},numeric.T.prototype.getDiag=function(){var r=numeric,e=this.x,n=this.y;return n?new r.T(r.getDiag(e),r.getDiag(n)):new r.T(r.getDiag(e))},numeric.house=function(r){var e=numeric.clone(r),r=(0<=r[0]?1:-1)*numeric.norm2(r);e[0]+=r;r=numeric.norm2(e);if(0===r)throw new Error("eig: internal error");return numeric.div(e,r)},numeric.toUpperHessenberg=function(r){var e=numeric.dim(r);if(2!==e.length||e[0]!==e[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");for(var n,t,i,o,u,a,c,f,s,m=e[0],h=numeric.clone(r),l=numeric.identity(m),d=0;d<m-2;d++){for(i=Array(m-d-1),n=d+1;n<m;n++)i[n-d-1]=h[n][d];if(0<numeric.norm2(i)){for(o=numeric.house(i),u=numeric.getBlock(h,[d+1,d],[m-1,m-1]),a=numeric.tensor(o,numeric.dot(o,u)),n=d+1;n<m;n++)for(c=h[n],f=a[n-d-1],t=d;t<m;t++)c[t]-=2*f[t-d];for(u=numeric.getBlock(h,[0,d+1],[m-1,m-1]),a=numeric.tensor(numeric.dot(u,o),o),n=0;n<m;n++)for(c=h[n],f=a[n],t=d+1;t<m;t++)c[t]-=2*f[t-d-1];for(u=Array(m-d-1),n=d+1;n<m;n++)u[n-d-1]=l[n];for(a=numeric.tensor(o,numeric.dot(o,u)),n=d+1;n<m;n++)for(s=l[n],f=a[n-d-1],t=0;t<m;t++)s[t]-=2*f[t]}}return{H:h,Q:l}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(r,e){void 0===e&&(e=1e4),r=numeric.clone(r),numeric.clone(r);var n,t,i,o,u,a,c,f,s=numeric.dim(r)[0],m=numeric.identity(s);if(s<3)return{Q:m,B:[[0,s-1]]};for(var h=numeric.epsilon,l=0;l<e;l++){for(c=0;c<s-1;c++)if(Math.abs(r[c+1][c])<h*(Math.abs(r[c][c])+Math.abs(r[c+1][c+1]))){for(var d=numeric.QRFrancis(numeric.getBlock(r,[0,0],[c,c]),e),g=numeric.QRFrancis(numeric.getBlock(r,[c+1,c+1],[s-1,s-1]),e),p=Array(c+1),v=0;v<=c;v++)p[v]=m[v];for(u=numeric.dot(d.Q,p),v=0;v<=c;v++)m[v]=u[v];for(p=Array(s-c-1),v=c+1;v<s;v++)p[v-c-1]=m[v];for(u=numeric.dot(g.Q,p),v=c+1;v<s;v++)m[v]=u[v-c-1];return{Q:m,B:d.B.concat(numeric.add(g.B,c+1))}}var y,w,x=r[s-2][s-2],b=r[s-2][s-1],A=r[s-1][s-2],M=x+(y=r[s-1][s-1]),x=x*y-b*A;for(y=numeric.getBlock(r,[0,0],[2,2]),n=[(y=4*x<=M*M?(b=.5*(M+Math.sqrt(M*M-4*x)),A=.5*(M-Math.sqrt(M*M-4*x)),numeric.add(numeric.sub(numeric.dot(y,y),numeric.mul(y,b+A)),numeric.diag(numeric.rep([3],b*A)))):numeric.add(numeric.sub(numeric.dot(y,y),numeric.mul(y,M)),numeric.diag(numeric.rep([3],x))))[0][0],y[1][0],y[2][0]],t=numeric.house(n),p=[r[0],r[1],r[2]],u=numeric.tensor(t,numeric.dot(t,p)),v=0;v<3;v++)for(o=r[v],a=u[v],f=0;f<s;f++)o[f]-=2*a[f];for(p=numeric.getBlock(r,[0,0],[s-1,2]),u=numeric.tensor(numeric.dot(p,t),t),v=0;v<s;v++)for(o=r[v],a=u[v],f=0;f<3;f++)o[f]-=2*a[f];for(p=[m[0],m[1],m[2]],u=numeric.tensor(t,numeric.dot(t,p)),v=0;v<3;v++)for(i=m[v],a=u[v],f=0;f<s;f++)i[f]-=2*a[f];for(c=0;c<s-2;c++){for(f=c;f<=c+1;f++)if(Math.abs(r[f+1][f])<h*(Math.abs(r[f][f])+Math.abs(r[f+1][f+1]))){d=numeric.QRFrancis(numeric.getBlock(r,[0,0],[f,f]),e),g=numeric.QRFrancis(numeric.getBlock(r,[f+1,f+1],[s-1,s-1]),e);for(p=Array(f+1),v=0;v<=f;v++)p[v]=m[v];for(u=numeric.dot(d.Q,p),v=0;v<=f;v++)m[v]=u[v];for(p=Array(s-f-1),v=f+1;v<s;v++)p[v-f-1]=m[v];for(u=numeric.dot(g.Q,p),v=f+1;v<s;v++)m[v]=u[v-f-1];return{Q:m,B:d.B.concat(numeric.add(g.B,f+1))}}for(w=Math.min(s-1,c+3),n=Array(w-c),v=c+1;v<=w;v++)n[v-c-1]=r[v][c];for(t=numeric.house(n),p=numeric.getBlock(r,[c+1,c],[w,s-1]),u=numeric.tensor(t,numeric.dot(t,p)),v=c+1;v<=w;v++)for(o=r[v],a=u[v-c-1],f=c;f<s;f++)o[f]-=2*a[f-c];for(p=numeric.getBlock(r,[0,c+1],[s-1,w]),u=numeric.tensor(numeric.dot(p,t),t),v=0;v<s;v++)for(o=r[v],a=u[v],f=c+1;f<=w;f++)o[f]-=2*a[f-c-1];for(p=Array(w-c),v=c+1;v<=w;v++)p[v-c-1]=m[v];for(u=numeric.tensor(t,numeric.dot(t,p)),v=c+1;v<=w;v++)for(i=m[v],a=u[v-c-1],f=0;f<s;f++)i[f]-=2*a[f]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(r,e){for(var n,t,i,o,u,a,c,f,s,m,h,l,d,g=numeric.toUpperHessenberg(r),e=numeric.QRFrancis(g.H,e),p=numeric.T,v=(r.length,e.B),y=numeric.dot(e.Q,numeric.dot(g.H,numeric.transpose(e.Q))),w=new p(numeric.dot(e.Q,g.Q)),x=v.length,b=Math.sqrt,A=0;A<x;A++)(n=v[A][0])===v[A][1]||(t=y[n][n],i=y[n][_=n+1],o=y[_][n],u=y[_][_],0===i&&0===o||(u=0<=(c=(a=-t-u)*a-4*(t*u-i*o))?new p([[h=(d=o*o+(u-(f=a<0?-.5*(a-b(c)):-.5*(a+b(c))))*(u-f))<(l=(t-f)*(t-f)+i*i)?(m=(t-f)/(l=b(l)),i/l):(m=o/(d=b(d)),(u-f)/d),-m],[m,h]]):(f=-.5*a,s=.5*b(-c),(d=o*o+(u-f)*(u-f))<(l=(t-f)*(t-f)+i*i)?(m=(t-f)/(l=b(l+s*s)),h=i/l,f=0,s/=l):(m=o/(d=b(d+s*s)),h=(u-f)/d,f=s/d,s=0),new p([[h,-m],[m,h]],[[f,s],[s,-f]])),w.setRows(n,_,u.dot(w.getRows(n,_)))));for(var M=w.dot(r).dot(w.transjugate()),D=r.length,T=numeric.T.identity(D),_=0;_<D;_++)if(0<_)for(A=_-1;0<=A;A--){var S=M.get([A,A]),k=M.get([_,_]);numeric.neq(S.x,k.x)||numeric.neq(S.y,k.y)?(f=M.getRow(A).getBlock([A],[_-1]),s=T.getRow(_).getBlock([A],[_-1]),T.set([_,A],M.get([A,_]).neg().sub(f.dot(s)).div(S.sub(k)))):T.setRow(_,T.getRow(A))}for(_=0;_<D;_++)f=T.getRow(_),T.setRow(_,f.div(f.norm2()));return T=T.transpose(),T=w.transjugate().dot(T),{lambda:M.getDiag(),E:T}},numeric.ccsSparse=function(r){for(var e,n,t=r.length,i=[],o=t-1;-1!==o;--o)for(n in e=r[o]){for(n=parseInt(n);n>=i.length;)i[i.length]=0;0!==e[n]&&i[n]++}var u=i.length,a=Array(u+1);for(o=a[0]=0;o<u;++o)a[o+1]=a[o]+i[o];var c=Array(a[u]),f=Array(a[u]);for(o=t-1;-1!==o;--o)for(n in e=r[o])0!==e[n]&&(i[n]--,c[a[n]+i[n]]=o,f[a[n]+i[n]]=e[n]);return[a,c,f]},numeric.ccsFull=function(r){for(var e,n,t,i=r[0],o=r[1],u=r[2],a=numeric.ccsDim(r),r=a[0],c=a[1],f=numeric.rep([r,c],0),s=0;s<c;s++)for(n=i[s],t=i[s+1],e=n;e<t;++e)f[o[e]][s]=u[e];return f},numeric.ccsTSolve=function(r,e,t,n,i){var o,u,a,c,f,s,m,h=r[0],l=r[1],d=r[2],r=h.length-1,g=Math.max,p=0;for(void 0===n&&(t=numeric.rep([r],0)),void 0===n&&(n=numeric.linspace(0,t.length-1)),void 0===i&&(i=[]),o=n.length-1;-1!==o;--o)!function r(e){var n;if(0===t[e]){for(t[e]=1,n=h[e];n<h[e+1];++n)r(l[n]);i[p]=e,++p}}(n[o]);for(i.length=p,o=i.length-1;-1!==o;--o)t[i[o]]=0;for(o=n.length-1;-1!==o;--o)u=n[o],t[u]=e[u];for(o=i.length-1;-1!==o;--o){for(u=i[o],a=h[u],c=g(h[u+1],a),f=a;f!==c;++f)if(l[f]===u){t[u]/=d[f];break}for(m=t[u],f=a;f!==c;++f)(s=l[f])!==u&&(t[s]-=m*d[f])}return t},numeric.ccsDFS=function(r){this.k=Array(r),this.k1=Array(r),this.j=Array(r)},numeric.ccsDFS.prototype.dfs=function(r,e,n,t,i,o){var u,a,c,f=0,s=i.length,m=this.k,h=this.k1,l=this.j;if(0===t[r])for(t[r]=1,l[0]=r,m[0]=a=e[r],h[0]=c=e[r+1];;)if(c<=a){if(i[s]=l[f],0===f)return;++s,a=m[--f],c=h[f]}else 0===t[u=o[n[a]]]?(t[u]=1,m[f]=a,a=e[l[++f]=u],h[f]=c=e[u+1]):++a},numeric.ccsLPSolve=function(r,e,n,t,i,o,u){var a=r[0],c=r[1],f=r[2];a.length;var s,m,h,l,d,g,p,r=e[0],v=e[1],y=e[2],e=r[i],w=r[i+1];for(t.length=0,s=e;s<w;++s)u.dfs(o[v[s]],a,c,n,t,o);for(s=t.length-1;-1!==s;--s)n[t[s]]=0;for(s=e;s!==w;++s)n[m=o[v[s]]]=y[s];for(s=t.length-1;-1!==s;--s){for(h=a[m=t[s]],l=a[m+1],d=h;d<l;++d)if(o[c[d]]===m){n[m]/=f[d];break}for(p=n[m],d=h;d<l;++d)(g=o[c[d]])!==m&&(n[g]-=p*f[d])}return n},numeric.ccsLUP1=function(r,e){var n,t,i,o,u,a,c,f=r[0].length-1,s=[numeric.rep([1+f],0),[],[]],m=[numeric.rep([1+f],0),[],[]],h=s[0],l=s[1],d=s[2],g=m[0],p=m[1],v=m[2],y=numeric.rep([f],0),w=numeric.rep([f],0),x=numeric.ccsLPSolve,b=Math.abs,A=numeric.linspace(0,f-1),M=numeric.linspace(0,f-1),D=new numeric.ccsDFS(f);for(void 0===e&&(e=1),n=0;n<f;++n){for(x(s,r,y,w,n,M,D),u=o=-1,t=w.length-1;-1!==t;--t)(i=w[t])<=n||o<(a=b(y[i]))&&(u=i,o=a);for(b(y[n])<e*o&&(t=A[n],o=A[u],M[A[n]=o]=n,M[A[u]=t]=u,o=y[n],y[n]=y[u],y[u]=o),o=h[n],u=g[n],c=y[n],l[o]=A[n],d[o]=1,++o,t=w.length-1;-1!==t;--t)a=y[i=w[t]],w[t]=0,y[i]=0,i<=n?(p[u]=i,v[u]=a,++u):(l[o]=A[i],d[o]=a/c,++o);h[n+1]=o,g[n+1]=u}for(t=l.length-1;-1!==t;--t)l[t]=M[l[t]];return{L:s,U:m,P:A,Pinv:M}},numeric.ccsDFS0=function(r){this.k=Array(r),this.k1=Array(r),this.j=Array(r)},numeric.ccsDFS0.prototype.dfs=function(r,e,n,t,i,o,u){var a,c,f,s=0,m=i.length,h=this.k,l=this.k1,d=this.j;if(0===t[r])for(t[r]=1,d[0]=r,h[0]=c=e[o[r]],l[0]=f=e[o[r]+1];;){if(isNaN(c))throw new Error("Ow!");if(f<=c){if(i[m]=o[d[s]],0===s)return;++m,c=h[--s],f=l[s]}else 0===t[a=n[c]]?(t[a]=1,h[s]=c,c=e[a=o[d[++s]=a]],l[s]=f=e[a+1]):++c}},numeric.ccsLPSolve0=function(r,e,n,t,i,o,u,a){var c=r[0],f=r[1],s=r[2];c.length;var m,h,l,d,g,p,v,r=e[0],y=e[1],w=e[2],e=r[i],x=r[i+1];for(t.length=0,m=e;m<x;++m)a.dfs(y[m],c,f,n,t,o,u);for(m=t.length-1;-1!==m;--m)n[u[h=t[m]]]=0;for(m=e;m!==x;++m)n[h=y[m]]=w[m];for(m=t.length-1;-1!==m;--m){for(p=u[h=t[m]],l=c[h],d=c[h+1],g=l;g<d;++g)if(f[g]===p){n[p]/=s[g];break}for(v=n[p],g=l;g<d;++g)n[f[g]]-=v*s[g];n[p]=v}},numeric.ccsLUP0=function(r,e){var n,t,i,o,u,a,c,f=r[0].length-1,s=[numeric.rep([1+f],0),[],[]],m=[numeric.rep([1+f],0),[],[]],h=s[0],l=s[1],d=s[2],g=m[0],p=m[1],v=m[2],y=numeric.rep([f],0),w=numeric.rep([f],0),x=numeric.ccsLPSolve0,b=Math.abs,A=numeric.linspace(0,f-1),M=numeric.linspace(0,f-1),D=new numeric.ccsDFS0(f);for(void 0===e&&(e=1),n=0;n<f;++n){for(x(s,r,y,w,n,M,A,D),u=o=-1,t=w.length-1;-1!==t;--t)(i=w[t])<=n||o<(a=b(y[A[i]]))&&(u=i,o=a);for(b(y[A[n]])<e*o&&(t=A[n],o=A[u],M[A[n]=o]=n,M[A[u]=t]=u),o=h[n],u=g[n],c=y[A[n]],l[o]=A[n],d[o]=1,++o,t=w.length-1;-1!==t;--t)a=y[A[i=w[t]]],w[t]=0,y[A[i]]=0,i<=n?(p[u]=i,v[u]=a,++u):(l[o]=A[i],d[o]=a/c,++o);h[n+1]=o,g[n+1]=u}for(t=l.length-1;-1!==t;--t)l[t]=M[l[t]];return{L:s,U:m,P:A,Pinv:M}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(r){return[numeric.sup(r[1])+1,r[0].length-1]},numeric.ccsGetBlock=function(r,e,n){var t=numeric.ccsDim(r),i=t[0],t=t[1];void 0===e?e=numeric.linspace(0,i-1):"number"==typeof e&&(e=[e]),void 0===n?n=numeric.linspace(0,t-1):"number"==typeof n&&(n=[n]);for(var o,u=e.length,a=n.length,c=numeric.rep([t],0),f=[],s=[],t=[c,f,s],m=r[0],h=r[1],l=r[2],d=numeric.rep([i],0),g=0,p=numeric.rep([i],0),v=0;v<a;++v){for(var y,w=m[y=n[v]],x=m[y+1],b=w;b<x;++b)p[o=h[b]]=1,d[o]=l[b];for(b=0;b<u;++b)p[e[b]]&&(f[g]=b,s[g]=d[e[b]],++g);for(b=w;b<x;++b)p[o=h[b]]=0;c[v+1]=g}return t},numeric.ccsDot=function(r,e){var n=r[0],t=r[1],i=r[2],o=e[0],u=e[1],a=e[2],c=numeric.ccsDim(r),r=numeric.ccsDim(e),e=c[0];c[1];for(var f,s,m,h,l,d,g,p,v,y,w=r[1],x=numeric.rep([e],0),b=numeric.rep([e],0),A=Array(e),M=numeric.rep([w],0),D=[],T=[],e=[M,D,T],_=0;_!==w;++_){for(m=o[_],h=o[_+1],p=0,s=m;s<h;++s)for(v=u[s],y=a[s],l=n[v],d=n[v+1],f=l;f<d;++f)0===b[g=t[f]]&&(p+=b[A[p]=g]=1),x[g]=x[g]+i[f]*y;for(m=M[_],M[_+1]=h=m+p,s=p-1;-1!==s;--s)f=A[s],D[y=m+s]=f,T[y]=x[f],b[f]=0,x[f]=0;M[_+1]=M[_]+p}return e},numeric.ccsLUPSolve=function(r,e){var n=r.L,t=r.U;r.P;var i=e[0],o=!1;"object"!=typeof i&&(i=(e=[[0,e.length],numeric.linspace(0,e.length-1),e])[0],o=!0);for(var u,a,c,f,s,m=e[1],h=e[2],e=n[0].length-1,l=i.length-1,d=numeric.rep([e],0),g=Array(e),p=numeric.rep([e],0),v=Array(e),y=numeric.rep([1+l],0),w=[],x=[],b=numeric.ccsTSolve,A=0,M=0;M<l;++M){for(f=0,a=i[M],c=i[M+1],u=a;u<c;++u)s=r.Pinv[m[u]],p[v[f]=s]=h[u],++f;for(v.length=f,b(n,p,d,v,g),u=v.length-1;-1!==u;--u)p[v[u]]=0;if(b(t,d,p,g,v),o)return p;for(u=g.length-1;-1!==u;--u)d[g[u]]=0;for(u=v.length-1;-1!==u;--u)s=v[u],w[A]=s,x[A]=p[s],p[s]=0,++A;y[M+1]=A}return[y,w,x]},numeric.ccsbinop=function(r,e){return void 0===e&&(e=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+e+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+r+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(r){for(var e=r[0],n=r[1],t=r[2],i=numeric.sup(n)+1,o=e.length,u=numeric.rep([i],0),a=Array(o),c=Array(o),f=numeric.rep([i],0),s=0;s<o;++s)f[n[s]]++;for(s=0;s<i;++s)u[s+1]=u[s]+f[s];var m,h,l=u.slice(0);for(s=0;s<o;++s)a[m=l[h=n[s]]]=e[s],c[m]=t[s],l[h]=l[h]+1;return[u,a,c]},numeric.ccsGather=function(r){for(var e,n,t,i=r[0],o=r[1],u=r[2],a=i.length-1,r=o.length,c=Array(r),f=Array(r),s=Array(r),m=0,h=0;h<a;++h)for(n=i[h],t=i[h+1],e=n;e!==t;++e)f[m]=h,c[m]=o[e],s[m]=u[e],++m;return[c,f,s]},numeric.sdim=function r(e,n,t){if(void 0===n&&(n=[]),"object"!=typeof e)return n;for(var i in(t=void 0===t?0:t)in n||(n[t]=0),e.length>n[t]&&(n[t]=e.length),e)e.hasOwnProperty(i)&&r(e[i],n,t+1);return n},numeric.sclone=function r(e,n,t){void 0===n&&(n=0),void 0===t&&(t=numeric.sdim(e).length);var i,o=Array(e.length);if(n===t-1){for(i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);return o}for(i in e)e.hasOwnProperty(i)&&(o[i]=r(e[i],n+1,t));return o},numeric.sdiag=function(r){for(var e,n=r.length,t=Array(n),i=n-1;1<=i;i-=2)e=i-1,t[i]=[],t[i][i]=r[i],t[e]=[],t[e][e]=r[e];return 0===i&&(t[0]=[],t[0][0]=r[i]),t},numeric.sidentity=function(r){return numeric.sdiag(numeric.rep([r],1))},numeric.stranspose=function(r){var e,n,t,i=[];for(e in r.length,r)if(r.hasOwnProperty(e))for(n in t=r[e])t.hasOwnProperty(n)&&("object"!=typeof i[n]&&(i[n]=[]),i[n][e]=t[n]);return i},numeric.sLUP=function(r,e){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(r,e){var n=r.length;e.length;for(var t,i,o,u,a,c,f=numeric.stranspose(e),s=f.length,m=Array(n),h=n-1;0<=h;h--){for(c=[],t=r[h],u=s-1;0<=u;u--){for(o in a=0,i=f[u],t)t.hasOwnProperty(o)&&o in i&&(a+=t[o]*i[o]);a&&(c[u]=a)}m[h]=c}return m},numeric.sdotMV=function(r,e){for(var n,t,i,o=r.length,u=Array(o),a=o-1;0<=a;a--){for(t in i=0,n=r[a])n.hasOwnProperty(t)&&e[t]&&(i+=n[t]*e[t]);i&&(u[a]=i)}return u},numeric.sdotVM=function(r,e){var n,t,i,o,u=[];for(n in r)if(r.hasOwnProperty(n))for(t in i=e[n],o=r[n],i)i.hasOwnProperty(t)&&(u[t]||(u[t]=0),u[t]+=o*i[t]);return u},numeric.sdotVV=function(r,e){var n,t=0;for(n in r)r[n]&&e[n]&&(t+=r[n]*e[n]);return t},numeric.sdot=function(r,e){var n=numeric.sdim(r).length,t=numeric.sdim(e).length;switch(1e3*n+t){case 0:return r*e;case 1001:return numeric.sdotVV(r,e);case 2001:return numeric.sdotMV(r,e);case 1002:return numeric.sdotVM(r,e);case 2002:return numeric.sdotMM(r,e);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+t)}},numeric.sscatter=function(r){for(var e,n,t,i=r[0].length,o=r.length,u=[],a=i-1;0<=a;--a)if(r[o-1][a]){for(t=u,n=0;n<o-2;n++)t[e=r[n][a]]||(t[e]=[]),t=t[e];t[r[n][a]]=r[n+1][a]}return u},numeric.sgather=function r(e,n,t){var i,o,u;for(o in void 0===n&&(n=[]),i=(t=void 0===t?[]:t).length,e)if(e.hasOwnProperty(o))if(t[i]=parseInt(o),"number"==typeof(u=e[o])){if(u){if(0===n.length)for(o=i+1;0<=o;--o)n[o]=[];for(o=i;0<=o;--o)n[o].push(t[o]);n[i+1].push(u)}}else r(u,n,t);return t.length>i&&t.pop(),n},numeric.cLU=function(r){for(var e,n,t,i,o=r[0],u=r[1],a=r[2],c=o.length,f=0,s=0;s<c;s++)o[s]>f&&(f=o[s]);f++;for(var m,h=Array(f),l=Array(f),d=numeric.rep([f],1/0),g=numeric.rep([f],-1/0),p=0;p<c;p++)s=o[p],(e=u[p])<d[s]&&(d[s]=e),e>g[s]&&(g[s]=e);for(s=0;s<f-1;s++)g[s]>g[s+1]&&(g[s+1]=g[s]);for(s=f-1;1<=s;s--)d[s]<d[s-1]&&(d[s-1]=d[s]);for(s=0;s<f;s++)l[s]=numeric.rep([g[s]-d[s]+1],0),h[s]=numeric.rep([s-d[s]],0),d[s],g[s];for(p=0;p<c;p++)l[s=o[p]][u[p]-d[s]]=a[p];for(s=0;s<f-1;s++)for(n=s-d[s],w=l[s],e=s+1;d[e]<=s&&e<f;e++)if(t=s-d[e],i=g[s]-s,m=(x=l[e])[t]/w[n]){for(p=1;p<=i;p++)x[p+t]-=m*w[p+n];h[e][s-d[e]]=m}var v,y,w=[],x=[],b=[],A=[],M=[],D=[];for(s=v=c=0;s<f;s++){for(n=d[s],t=g[s],y=l[s],e=s;e<=t;e++)y[e-n]&&(w[c]=s,x[c]=e,b[c]=y[e-n],c++);for(y=h[s],e=n;e<s;e++)y[e-n]&&(A[v]=s,M[v]=e,D[v]=y[e-n],v++);A[v]=s,M[v]=s,D[v]=1,v++}return{U:[w,x,b],L:[A,M,D]}},numeric.cLUsolve=function(r,e){var n=r.L,r=r.U,t=numeric.clone(e),e=n[0],i=n[1],o=n[2],n=r[0],u=r[1],a=r[2],n=n.length;e.length;for(var c=t.length,f=0,s=0;s<c;s++){for(;i[f]<s;)t[s]-=o[f]*t[i[f]],f++;f++}for(f=n-1,s=c-1;0<=s;s--){for(;u[f]>s;)t[s]-=a[f]*t[u[f]],f--;t[s]/=a[f],f--}return t},numeric.cgrid=function(n,r){var e,t,i,o=numeric.rep(n="number"==typeof n?[n,n]:n,-1);for("function"!=typeof r&&(r="L"===r?function(r,e){return r>=n[0]/2||e<n[1]/2}:function(r,e){return!0}),i=0,e=1;e<n[0]-1;e++)for(t=1;t<n[1]-1;t++)r(e,t)&&(o[e][t]=i,i++);return o},numeric.cdelsq=function(r){for(var e,n,t,i,o=[[-1,0],[0,-1],[0,1],[1,0]],u=numeric.dim(r),a=u[0],c=u[1],f=[],s=[],m=[],h=1;h<a-1;h++)for(e=1;e<c-1;e++)if(!(r[h][e]<0)){for(n=0;n<4;n++)t=h+o[n][0],i=e+o[n][1],r[t][i]<0||(f.push(r[h][e]),s.push(r[t][i]),m.push(-1));f.push(r[h][e]),s.push(r[h][e]),m.push(4)}return[f,s,m]},numeric.cdotMV=function(r,e){for(var n,t=r[0],i=r[1],o=r[2],u=t.length,a=0,c=0;c<u;c++)t[c]>a&&(a=t[c]);for(n=numeric.rep([++a],0),c=0;c<u;c++)n[t[c]]+=o[c]*e[i[c]];return n},numeric.Spline=function(r,e,n,t,i){this.x=r,this.yl=e,this.yr=n,this.kl=t,this.kr=i},numeric.Spline.prototype._at=function(r,e){var n=this.x,t=this.yl,i=this.yr,o=this.kl,u=this.kr,a=numeric.add,c=numeric.sub,f=numeric.mul,o=c(f(o[e],n[e+1]-n[e]),c(i[e+1],t[e])),c=a(f(u[e+1],n[e]-n[e+1]),c(i[e+1],t[e])),r=(r-n[e])/(n[e+1]-n[e]),n=r*(1-r);return a(a(a(f(1-r,t[e]),f(r,i[e+1])),f(o,n*(1-r))),f(c,n*r))},numeric.Spline.prototype.at=function(r){if("number"==typeof r){for(var e,n=this.x,t=n.length,i=Math.floor,o=0,u=t-1;1<u-o;)n[e=i((o+u)/2)]<=r?o=e:u=e;return this._at(r,o)}for(var t=r.length,a=Array(t),c=t-1;-1!==c;--c)a[c]=this.at(r[c]);return a},numeric.Spline.prototype.diff=function(){for(var r,e,n=this.x,t=this.yl,i=this.yr,o=this.kl,u=this.kr,a=t.length,c=o,f=u,s=Array(a),m=Array(a),h=numeric.add,l=numeric.mul,d=numeric.div,g=numeric.sub,p=a-1;-1!==p;--p)r=n[p+1]-n[p],e=g(i[p+1],t[p]),s[p]=d(h(l(e,6),l(o[p],-4*r),l(u[p+1],-2*r)),r*r),m[p+1]=d(h(l(e,-6),l(o[p],2*r),l(u[p+1],4*r)),r*r);return new numeric.Spline(n,c,f,s,m)},numeric.Spline.prototype.roots=function(){var r=[],e=this.x,n=this.yl,t=this.yr,i=this.kl,o=this.kr;"number"==typeof n[0]&&(n=[n],t=[t],i=[i],o=[o]);for(var u,a,c,f,s,m,h,l,d,g,p,v,y,w,x,b,A,M,D,T,_,S,k=n.length,j=e.length-1,r=Array(k),P=Math.sqrt,I=0;I!==k;++I){for(c=n[I],f=t[I],s=i[I],m=o[I],h=[],u=0;u!==j;u++){for(0<u&&f[u]*c[u]<0&&h.push(e[u]),w=e[u+1]-e[u],e[u],g=c[u],p=f[u+1],l=s[u]/w,v=(d=m[u+1]/w)+3*g+2*l-3*p,y=3*(d+l+2*(g-p)),(w=(S=l-d+3*(g-p))*S+12*d*g)<=0?x=(b=v/y)>e[u]&&b<e[u+1]?[e[u],b,e[u+1]]:[e[u],e[u+1]]:(b=(v-P(w))/y,A=(v+P(w))/y,x=[e[u]],b>e[u]&&b<e[u+1]&&x.push(b),A>e[u]&&A<e[u+1]&&x.push(A),x.push(e[u+1])),D=x[0],b=this._at(D,u),a=0;a<x.length-1;a++)if(T=x[a+1],A=this._at(T,u),0!==b)if(0===A||0<b*A)D=T,b=A;else{for(var N=0;!((_=(b*T-A*D)/(b-A))<=D||T<=_);)if(0<(M=this._at(_,u))*A)T=_,A=M,-1===N&&(b*=.5),N=-1;else{if(!(0<M*b))break;D=_,b=M,1===N&&(A*=.5),N=1}h.push(_),D=x[a+1],b=this._at(D,u)}else h.push(D),D=T,b=A;0===A&&h.push(T)}r[I]=h}return"number"==typeof this.yl[0]?r[0]:r},numeric.spline=function(r,e,n,t){for(var i=r.length,o=[],u=[],a=[],c=numeric.sub,f=numeric.mul,s=numeric.add,m=i-2;0<=m;m--)u[m]=r[m+1]-r[m],a[m]=c(e[m+1],e[m]);var h=[[],[],[]];switch(typeof(n="string"==typeof n||"string"==typeof t?t="periodic":n)){case"undefined":o[0]=f(3/(u[0]*u[0]),a[0]),h[0].push(0,0),h[1].push(0,1),h[2].push(2/u[0],1/u[0]);break;case"string":o[0]=s(f(3/(u[i-2]*u[i-2]),a[i-2]),f(3/(u[0]*u[0]),a[0])),h[0].push(0,0,0),h[1].push(i-2,0,1),h[2].push(1/u[i-2],2/u[i-2]+2/u[0],1/u[0]);break;default:o[0]=n,h[0].push(0),h[1].push(0),h[2].push(1)}for(m=1;m<i-1;m++)o[m]=s(f(3/(u[m-1]*u[m-1]),a[m-1]),f(3/(u[m]*u[m]),a[m])),h[0].push(m,m,m),h[1].push(m-1,m,m+1),h[2].push(1/u[m-1],2/u[m-1]+2/u[m],1/u[m]);switch(typeof t){case"undefined":o[i-1]=f(3/(u[i-2]*u[i-2]),a[i-2]),h[0].push(i-1,i-1),h[1].push(i-2,i-1),h[2].push(1/u[i-2],2/u[i-2]);break;case"string":h[1][h[1].length-1]=0;break;default:o[i-1]=t,h[0].push(i-1),h[1].push(i-1),h[2].push(1)}var o="number"!=typeof o[0]?numeric.transpose(o):[o],l=Array(o.length);if("string"==typeof n)for(m=l.length-1;-1!==m;--m)l[m]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(h)),o[m]),l[m][i-1]=l[m][0];else for(m=l.length-1;-1!==m;--m)l[m]=numeric.cLUsolve(numeric.cLU(h),o[m]);return l="number"==typeof e[0]?l[0]:numeric.transpose(l),new numeric.Spline(r,e,e,l,l)},numeric.fftpow2=function r(e,n){var t=e.length;if(1!==t){for(var i=Math.cos,o=Math.sin,u=Array(t/2),a=Array(t/2),c=Array(t/2),f=Array(t/2),s=t/2,m=t-1;-1!==m;--m)c[--s]=e[m],f[s]=n[m],u[s]=e[--m],a[s]=n[m];r(u,a),r(c,f),s=t/2;var h,l,d=-6.283185307179586/t;for(m=t-1;-1!==m;--m)-1===--s&&(s=t/2-1),h=i(l=d*m),l=o(l),e[m]=u[s]+h*c[s]-l*f[s],n[m]=a[s]+h*f[s]+l*c[s]}},numeric._ifftpow2=function r(e,n){var t=e.length;if(1!==t){for(var i=Math.cos,o=Math.sin,u=Array(t/2),a=Array(t/2),c=Array(t/2),f=Array(t/2),s=t/2,m=t-1;-1!==m;--m)c[--s]=e[m],f[s]=n[m],u[s]=e[--m],a[s]=n[m];r(u,a),r(c,f),s=t/2;var h,l,d=6.283185307179586/t;for(m=t-1;-1!==m;--m)-1===--s&&(s=t/2-1),h=i(l=d*m),l=o(l),e[m]=u[s]+h*c[s]-l*f[s],n[m]=a[s]+h*f[s]+l*c[s]}},numeric.ifftpow2=function(r,e){numeric._ifftpow2(r,e),numeric.diveq(r,r.length),numeric.diveq(e,e.length)},numeric.convpow2=function(r,e,n,t){numeric.fftpow2(r,e),numeric.fftpow2(n,t);for(var i,o,u,a,c=r.length-1;-1!==c;--c)i=r[c],u=e[c],o=n[c],a=t[c],r[c]=i*o-u*a,e[c]=i*a+u*o;numeric.ifftpow2(r,e)},numeric.T.prototype.fft=function(){for(var r,e=this.x,n=this.y,t=e.length,i=Math.log,o=i(2),i=Math.ceil(i(2*t-1)/o),u=Math.pow(2,i),a=numeric.rep([u],0),c=numeric.rep([u],0),f=Math.cos,s=Math.sin,m=-3.141592653589793/t,h=numeric.rep([u],0),l=numeric.rep([u],0),d=0;d<t;d++)h[d]=e[d];if(void 0!==n)for(d=0;d<t;d++)l[d]=n[d];for(d=a[0]=1;d<=u/2;d++)a[d]=f(r=m*d*d),c[d]=s(r),a[u-d]=f(r),c[u-d]=s(r);o=new numeric.T(h,l),i=new numeric.T(a,c),o=o.mul(i);return numeric.convpow2(o.x,o.y,numeric.clone(i.x),numeric.neg(i.y)),(o=o.mul(i)).x.length=t,o.y.length=t,o},numeric.T.prototype.ifft=function(){for(var r,e=this.x,n=this.y,t=e.length,i=Math.log,o=i(2),i=Math.ceil(i(2*t-1)/o),u=Math.pow(2,i),a=numeric.rep([u],0),c=numeric.rep([u],0),f=Math.cos,s=Math.sin,m=3.141592653589793/t,h=numeric.rep([u],0),l=numeric.rep([u],0),d=0;d<t;d++)h[d]=e[d];if(void 0!==n)for(d=0;d<t;d++)l[d]=n[d];for(d=a[0]=1;d<=u/2;d++)a[d]=f(r=m*d*d),c[d]=s(r),a[u-d]=f(r),c[u-d]=s(r);o=new numeric.T(h,l),i=new numeric.T(a,c),o=o.mul(i);return numeric.convpow2(o.x,o.y,numeric.clone(i.x),numeric.neg(i.y)),(o=o.mul(i)).x.length=t,o.y.length=t,o.div(t)},numeric.gradient=function(r,e){var n=e.length,t=r(e);if(isNaN(t))throw new Error("gradient: f(x) is a NaN!");var i,o,u=Math.max,a=numeric.clone(e),c=Array(n);numeric.div,numeric.sub;for(var f,s,m,h,l,u=Math.max,d=Math.abs,g=Math.min,p=0,v=0;v<n;v++)for(var y=u(1e-6*t,1e-8);;){if(20<++p)throw new Error("Numerical gradient fails");if(a[v]=e[v]+y,i=r(a),a[v]=e[v]-y,o=r(a),a[v]=e[v],isNaN(i)||isNaN(o))y/=16;else{if(c[v]=(i-o)/(2*y),f=e[v]-y,s=e[v],l=e[v]+y,m=(i-t)/y,h=(t-o)/y,l=u(d(c[v]),d(t),d(i),d(o),d(f),d(s),d(l),1e-8),!(.001<g(u(d(m-c[v]),d(h-c[v]),d(m-h))/l,y/l)))break;y/=16}}return c},numeric.uncmin=function(e,r,n,t,i,o,u){var a=numeric.gradient;void 0===u&&(u={}),void 0===n&&(n=1e-8),void 0===t&&(t=function(r){return a(e,r)}),void 0===i&&(i=1e3);var c,f,s=(r=numeric.clone(r)).length,m=e(r);if(isNaN(m))throw new Error("uncmin: f(x0) is a NaN!");var h=Math.max,l=numeric.norm2;n=h(n,numeric.epsilon);var d,g,p=u.Hinv||numeric.identity(s),v=numeric.dot;numeric.inv;for(var y,w,x,b,A,M,D,T=numeric.sub,_=numeric.add,S=numeric.tensor,k=numeric.div,j=numeric.mul,P=numeric.all,I=numeric.isFinite,N=numeric.neg,E=0,L="",C=t(r);E<i;){if("function"==typeof o&&o(E,r,m,C,p)){L="Callback returned true";break}if(!P(I(C))){L="Gradient has Infinity or NaN";break}if(!P(I(d=N(v(p,C))))){L="Search direction has Infinity or NaN";break}if((D=l(d))<n){L="Newton step smaller than tol";break}for(M=1,f=v(C,d),w=r;E<i&&!(M*D<n)&&(w=_(r,y=j(d,M)),.1*M*f<=(c=e(w))-m||isNaN(c));)M*=.5,++E;if(M*D<n){L="Line search step size smaller than tol";break}if(E===i){L="maxit reached during line search";break}A=v(x=T(g=t(w),C),y),b=v(p,x),p=T(_(p,j((A+v(x,b))/(A*A),S(y,y))),k(_(S(b,y),S(y,b)),A)),r=w,m=c,C=g,++E}return{solution:r,f:m,gradient:C,invHessian:p,iterations:E,message:L}},numeric.Dopri=function(r,e,n,t,i,o,u){this.x=r,this.y=e,this.f=n,this.ymid=t,this.iterations=i,this.events=u,this.message=o},numeric.Dopri.prototype._at=function(r,e){function n(r){return r*r}var t=this.x,i=this.y,o=this.f,u=this.ymid;t.length;var a=numeric.add,c=numeric.mul,f=numeric.sub,s=t[e],m=t[e+1],h=i[e],l=i[e+1],t=u[e],u=f(o[e],c(h,1/(s-(i=s+.5*(m-s)))+2/(s-m))),e=f(o[e+1],c(l,1/(m-i)+2/(m-s))),i=[n(r-m)*(r-i)/n(s-m)/(s-i),n(r-s)*n(r-m)/n(s-i)/n(m-i),n(r-s)*(r-i)/n(m-s)/(m-i),(r-s)*n(r-m)*(r-i)/n(s-m)/(s-i),(r-m)*n(r-s)*(r-i)/n(s-m)/(m-i)];return a(a(a(a(c(h,i[0]),c(t,i[1])),c(l,i[2])),c(u,i[3])),c(e,i[4]))},numeric.Dopri.prototype.at=function(r){var e,n,t=Math.floor;if("number"!=typeof r){for(var i=r.length,o=Array(i),u=i-1;-1!==u;--u)o[u]=this.at(r[u]);return o}var a=this.x;for(u=0,e=a.length-1;1<e-u;)a[n=t(.5*(u+e))]<=r?u=n:e=n;return this._at(r,u)},numeric.dopri=function(r,e,n,t,i,o,u){void 0===i&&(i=1e-6),void 0===o&&(o=1e3);var a,c,f,s,m,h,l,d,g,p=[r],v=[n],y=[t(r,n)],w=[],x=[.075,.225],b=[44/45,-56/15,32/9],A=[19372/6561,-25360/2187,64448/6561,-212/729],M=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],D=[35/384,0,500/1113,125/192,-2187/6784,11/84],T=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],_=[.2,.3,.8,8/9,1,1],S=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],k=0,j=(e-r)/10,P=0,I=numeric.add,N=numeric.mul,E=Math.min,L=Math.abs,C=numeric.norminf,V=Math.pow,W=numeric.any,H=numeric.lt,R=numeric.and;numeric.sub;var q=new numeric.Dopri(p,v,y,w,-1,"");for("function"==typeof u&&(g=u(r,n));r<e&&P<o;){if(++P,d=t(r+_[0]*(j=e<r+j?e-r:j),I(n,N(.2*j,y[k]))),a=t(r+_[1]*j,I(I(n,N(x[0]*j,y[k])),N(x[1]*j,d))),c=t(r+_[2]*j,I(I(I(n,N(b[0]*j,y[k])),N(b[1]*j,d)),N(b[2]*j,a))),f=t(r+_[3]*j,I(I(I(I(n,N(A[0]*j,y[k])),N(A[1]*j,d)),N(A[2]*j,a)),N(A[3]*j,c))),s=t(r+_[4]*j,I(I(I(I(I(n,N(M[0]*j,y[k])),N(M[1]*j,d)),N(M[2]*j,a)),N(M[3]*j,c)),N(M[4]*j,f))),m=t(r+j,l=I(I(I(I(I(n,N(y[k],j*D[0])),N(a,j*D[2])),N(c,j*D[3])),N(f,j*D[4])),N(s,j*D[5]))),i<(d=("number"==typeof(d=I(I(I(I(I(N(y[k],j*S[0]),N(a,j*S[2])),N(c,j*S[3])),N(f,j*S[4])),N(s,j*S[5])),N(m,j*S[6])))?L:C)(d))){if(r+(j=.2*j*V(i/d,.25))!==r)continue;q.msg="Step size became too small";break}if(w[k]=I(I(I(I(I(I(n,N(y[k],j*T[0])),N(a,j*T[2])),N(c,j*T[3])),N(f,j*T[4])),N(s,j*T[5])),N(m,j*T[6])),p[++k]=r+j,v[k]=l,y[k]=m,"function"==typeof u){var O,F,G,B=r,U=r+.5*j,Y=u(U,w[k-1]);if(W(G=R(H(g,0),H(0,Y)))||(B=U,g=Y,Y=u(U=r+j,l),G=R(H(g,0),H(0,Y))),W(G)){for(var X,z,Q=0,Z=1,K=1;;){if("number"==typeof g)F=(K*Y*B-Z*g*U)/(K*Y-Z*g);else for(F=U,h=g.length-1;-1!==h;--h)g[h]<0&&0<Y[h]&&(F=E(F,(K*Y[h]*B-Z*g[h]*U)/(K*Y[h]-Z*g[h])));if(F<=B||U<=F)break;z=u(F,O=q._at(F,k-1)),Q=W(X=R(H(g,0),H(0,z)))?(U=F,Y=z,G=X,-(K=1)===Q?Z*=.5:Z=1,-1):(B=F,g=z,(Z=1)===Q?K*=.5:K=1,1)}return l=q._at(.5*(r+F),k-1),q.f[k]=t(F,O),q.x[k]=F,q.y[k]=O,q.ymid[k-1]=l,q.events=G,q.iterations=P,q}}r+=j,n=l,g=Y,j=E(.8*j*V(i/d,.25),4*j)}return q.iterations=P,q},numeric.LU=function(r,e){e=e||!1;var n,t,i,o,u,a,c,f,s,m=Math.abs,h=r.length,l=h-1,d=new Array(h);for(e||(r=numeric.clone(r)),i=0;i<h;++i){for(s=m((a=r[c=i])[i]),t=i+1;t<h;++t)s<(o=m(r[t][i]))&&(s=o,c=t);for((d[i]=c)!=i&&(r[i]=r[c],r[c]=a,a=r[i]),u=a[i],n=i+1;n<h;++n)r[n][i]/=u;for(n=i+1;n<h;++n){for(f=r[n],t=i+1;t<l;++t)f[t]-=f[i]*a[t],f[++t]-=f[i]*a[t];t===l&&(f[t]-=f[i]*a[t])}}return{LU:r,P:d}},numeric.LUsolve=function(r,e){for(var n,t,i,o,u=r.LU,a=u.length,c=numeric.clone(e),f=r.P,s=a-1;-1!==s;--s)c[s]=e[s];for(s=0;s<a;++s)for(t=f[s],f[s]!==s&&(o=c[s],c[s]=c[t],c[t]=o),i=u[s],n=0;n<s;++n)c[s]-=c[n]*i[n];for(s=a-1;0<=s;--s){for(i=u[s],n=s+1;n<a;++n)c[s]-=c[n]*i[n];c[s]/=i[s]}return c},numeric.solve=function(r,e,n){return numeric.LUsolve(numeric.LU(r,n),e)},numeric.echelonize=function(r){var e,n,t,i,o,u,a,c,f=numeric.dim(r),s=f[0],m=f[1],h=numeric.identity(s),l=Array(s),d=Math.abs,g=numeric.diveq;for(r=numeric.clone(r),e=0;e<s;++e){for(t=0,o=r[e],u=h[e],n=1;n<m;++n)d(o[t])<d(o[n])&&(t=n);for(g(u,o[l[e]=t]),g(o,o[t]),n=0;n<s;++n)if(n!==e){for(c=(a=r[n])[t],i=m-1;-1!==i;--i)a[i]-=o[i]*c;for(a=h[n],i=s-1;-1!==i;--i)a[i]-=u[i]*c}}return{I:h,A:r,P:l}},numeric.__solveLP=function(r,e,n,t,i,o,u){var a=numeric.sum;numeric.log;var c=numeric.mul,f=numeric.sub,s=numeric.dot,m=numeric.div,h=numeric.add,l=r.length,d=n.length,g=!1,p=1;numeric.transpose(e),numeric.svd;var v=numeric.transpose;numeric.leq;var y=Math.sqrt,w=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var x=Math.min,b=numeric.all,A=numeric.gt,M=Array(l),D=Array(d);numeric.rep([d],1);for(var T=numeric.solve,_=f(n,s(e,o)),S=s(r,r),k=0;k<i;++k){for(W=d-1;-1!==W;--W)D[W]=m(e[W],_[W]);var j=v(D);for(W=l-1;-1!==W;--W)M[W]=a(j[W]);var p=.25*w(S/s(r,M)),P=100*y(S/s(M,M)),I=h(r,c(p=!isFinite(p)||P<p?P:p,M)),N=s(j,D);for(W=l-1;-1!==W;--W)N[W][W]+=1;var P=T(N,m(I,p),!0),E=m(_,s(e,P)),L=1;for(W=d-1;-1!==W;--W)E[W]<0&&(L=x(L,-.999*E[W]));if(P=f(o,c(P,L)),!b(A(_=f(n,s(e,P)),0)))return{solution:o,message:"",iterations:k};if(o=P,p<t)return{solution:P,message:"",iterations:k};if(u){for(var C=s(r,I),V=s(e,I),g=!0,W=d-1;-1!==W;--W)if(C*V[W]<0){g=!1;break}}else g=!(0<=o[l-1]);if(g)return{solution:P,message:"Unbounded",iterations:k}}return{solution:o,message:"maximum iteration count exceeded",iterations:k}},numeric._solveLP=function(r,e,n,t,i){var o=r.length,u=n.length;numeric.sum,numeric.log,numeric.mul;var a=numeric.sub,c=numeric.dot;numeric.div,numeric.add;var f=numeric.rep([o],0).concat([1]),s=numeric.rep([u,1],-1),m=numeric.blockMatrix([[e,s]]),u=n,s=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),u=numeric.__solveLP(f,m,u,t,i,s,!1),s=numeric.clone(u.solution);if(s.length=o,numeric.inf(a(n,c(e,s)))<0)return{solution:NaN,message:"Infeasible",iterations:u.iterations};s=numeric.__solveLP(r,e,n,t,i-u.iterations,s,!0);return s.iterations+=u.iterations,s},numeric.solveLP=function(r,e,n,t,i,o,u){if(void 0===u&&(u=1e3),void 0===o&&(o=numeric.epsilon),void 0===t)return numeric._solveLP(r,e,n,o,u);for(var a=t.length,c=t[0].length,f=e.length,s=numeric.echelonize(t),m=numeric.rep([c],0),h=s.P,l=[],d=h.length-1;-1!==d;--d)m[h[d]]=1;for(d=c-1;-1!==d;--d)0===m[d]&&l.push(d);var c=numeric.getRange,a=numeric.linspace(0,a-1),f=numeric.linspace(0,f-1),t=c(t,a,l),a=c(e,f,h),c=c(e,f,l),e=numeric.dot,f=numeric.sub,a=e(a,s.I),c=f(c,e(a,t)),n=f(n,e(a,i)),g=Array(h.length),p=Array(l.length);for(d=h.length-1;-1!==d;--d)g[d]=r[h[d]];for(d=l.length-1;-1!==d;--d)p[d]=r[l[d]];var a=f(p,e(g,e(s.I,t))),u=numeric._solveLP(a,c,n,o,u),v=u.solution;if(v!=v)return u;var y=e(s.I,f(i,e(t,v))),w=Array(r.length);for(d=h.length-1;-1!==d;--d)w[h[d]]=y[d];for(d=l.length-1;-1!==d;--d)w[l[d]]=v[d];return{solution:w,message:u.message,iterations:u.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var n,r,t=0,i=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],o=e.length,u=0,a={},c=[],f=0,s={},m=0,h=[],l=[],d=[];function g(r){throw new Error("MPStoLP: "+r+"\nLine "+n+": "+e[n]+"\nCurrent state: "+i[t]+"\n")}for(n=0;n<o;++n){var p,v=(p=e[n]).match(/\S*/g),y=[];for(b=0;b<v.length;++b)""!==v[b]&&y.push(v[b]);if(0!==y.length){for(b=0;b<i.length&&p.substr(0,i[b].length)!==i[b];++b);if(b<i.length){if(1===(t=b)&&(r=y[1]),6===b)return{name:r,c:h,A:numeric.transpose(l),b:d,rows:a,vars:s}}else switch(t){case 0:case 1:g("Unexpected line");case 2:switch(y[0]){case"N":0===u?u=y[1]:g("Two or more N rows");break;case"L":c[a[y[1]]=f]=1,d[f]=0,++f;break;case"G":c[a[y[1]]=f]=-1,d[f]=0,++f;break;case"E":c[a[y[1]]=f]=0,d[f]=0,++f;break;default:g("Parse error "+numeric.prettyPrint(y))}break;case 3:s.hasOwnProperty(y[0])||(h[s[y[0]]=m]=0,l[m]=numeric.rep([f],0),++m);for(var w,x=s[y[0]],b=1;b<y.length;b+=2)y[b]!==u?(w=a[y[b]],l[x][w]=(c[w]<0?-1:1)*parseFloat(y[b+1])):h[x]=parseFloat(y[b+1]);break;case 4:for(b=1;b<y.length;b+=2)d[a[y[b]]]=(c[a[y[b]]]<0?-1:1)*parseFloat(y[b+1]);break;case 5:break;case 6:g("Internal error")}}}g("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},IH=[],JH=numeric.seedrandom,KH=256,MH=52,JH.seedrandom=function(r,e){var t,n=[];return r=RH(function r(e,n,t,i,o){t=[];o=typeof e;if(n&&"object"==o)for(i in e)if(i.indexOf("S")<5)try{t.push(r(e[i],n-1))}catch(r){}return t.length?t:e+("string"!=o?"\0":"")}(e?[r,IH]:arguments.length?r:[(new Date).getTime(),IH,window],3),n),RH((t=new PH(n)).S,IH),JH.random=function(){for(var r=t.g(6),e=OH,n=0;r<MH;)r=(r+n)*KH,e*=KH,n=t.g(1);for(;NH<=r;)r/=2,e/=2,n>>>=1;return(r+n)/e},r},OH=JH.pow(KH,6),MH=JH.pow(2,MH),NH=2*MH,RH(JH.random(),IH),numeric.solveQP=function(r,e,n,t,i,o){r=BI(r),e=BI(e),n=BI(n);var u,a,c,f,s=[],m=[],h=[],l=[],d=[];if(i=i||0,o=o?BI(o):[void 0,0],t=t?BI(t):[],a=r.length-1,c=n[1].length-1,!t)for(u=1;u<=c;u+=1)t[u]=0;for(u=1;u<=c;u+=1)m[u]=0;for(f=Math.min(a,c),u=1;u<=a;u+=1)h[u]=0;for(s[1]=0,u=1;u<=2*a+f*(f+5)/2+2*c+1;u+=1)l[u]=0;for(u=1;u<=2;u+=1)d[u]=0;return GI(r,e,0,a,h,s,n,t,0,c,i,m,0,d,l,o),i="",1===o[1]&&(i="constraints are inconsistent, no solution!"),2===o[1]&&(i="matrix D in quadratic function is not positive definite!"),{solution:CI(h),value:CI(s),unconstrained_solution:CI(e),iterations:CI(d),iact:CI(m),message:i}},numeric.svd=function(r){var e,n=numeric.epsilon,t=1e-64/n,i=0,o=0,u=0,a=0,c=0,f=numeric.clone(r),s=f.length,m=f[0].length;if(s<m)throw"Need more rows than columns";var h=new Array(m),l=new Array(m);for(o=0;o<m;o++)h[o]=l[o]=0;var d=numeric.rep([m,m],0);function g(r,e){return r=Math.abs(r),(e=Math.abs(e))<r?r*Math.sqrt(1+e*e/r/r):0==e?r:e*Math.sqrt(1+r*r/e/e)}var p=0,v=0,y=0,w=0,x=0,b=0,A=0;for(o=0;o<m;o++){for(h[o]=v,A=0,c=o+1,u=o;u<s;u++)A+=f[u][o]*f[u][o];if(A<=t)v=0;else for(p=f[o][o],v=Math.sqrt(A),y=p*(v=0<=p?-v:v)-A,f[o][o]=p-v,u=c;u<m;u++){for(A=0,a=o;a<s;a++)A+=f[a][o]*f[a][u];for(p=A/y,a=o;a<s;a++)f[a][u]+=p*f[a][o]}for(l[o]=v,A=0,u=c;u<m;u++)A+=f[o][u]*f[o][u];if(A<=t)v=0;else{for(p=f[o][o+1],v=Math.sqrt(A),y=p*(v=0<=p?-v:v)-A,f[o][o+1]=p-v,u=c;u<m;u++)h[u]=f[o][u]/y;for(u=c;u<s;u++){for(A=0,a=c;a<m;a++)A+=f[u][a]*f[o][a];for(a=c;a<m;a++)f[u][a]+=A*h[a]}}w<(x=Math.abs(l[o])+Math.abs(h[o]))&&(w=x)}for(o=m-1;-1!=o;o+=-1){if(0!=v){for(y=v*f[o][o+1],u=c;u<m;u++)d[u][o]=f[o][u]/y;for(u=c;u<m;u++){for(A=0,a=c;a<m;a++)A+=f[o][a]*d[a][u];for(a=c;a<m;a++)d[a][u]+=A*d[a][o]}}for(u=c;u<m;u++)d[o][u]=0,d[u][o]=0;d[o][o]=1,v=h[o],c=o}for(o=m-1;-1!=o;o+=-1){for(v=l[o],u=c=o+1;u<m;u++)f[o][u]=0;if(0!=v){for(y=f[o][o]*v,u=c;u<m;u++){for(A=0,a=c;a<s;a++)A+=f[a][o]*f[a][u];for(p=A/y,a=o;a<s;a++)f[a][u]+=p*f[a][o]}for(u=o;u<s;u++)f[u][o]=f[u][o]/v}else for(u=o;u<s;u++)f[u][o]=0;f[o][o]+=1}for(n*=w,a=m-1;-1!=a;a+=-1)for(var M=0;M<50;M++){for(var D=!1,c=a;-1!=c;c+=-1){if(Math.abs(h[c])<=n){D=!0;break}if(Math.abs(l[c-1])<=n)break}if(!D)for(var i=0,A=1,T=c-1,o=c;o<a+1&&(p=A*h[o],h[o]=i*h[o],!(Math.abs(p)<=n));o++)for(y=g(p,v=l[o]),i=v/(l[o]=y),A=-p/y,u=0;u<s;u++)x=f[u][T],b=f[u][o],f[u][T]=x*i+b*A,f[u][o]=-x*A+b*i;if(b=l[a],c==a){if(b<0)for(l[a]=-b,u=0;u<m;u++)d[u][a]=-d[u][a];break}if(49<=M)throw"Error: no convergence.";for(w=l[c],v=g(p=(((x=l[a-1])-b)*(x+b)+((v=h[a-1])-(y=h[a]))*(v+y))/(2*y*x),1),p=p<0?((w-b)*(w+b)+y*(x/(p-v)-y))/w:((w-b)*(w+b)+y*(x/(p+v)-y))/w,o=c+(A=i=1);o<a+1;o++){for(v=h[o],x=l[o],y=A*v,v*=i,b=g(p,y),p=w*(i=p/(h[o-1]=b))+v*(A=y/b),v=-w*A+v*i,y=x*A,x*=i,u=0;u<m;u++)w=d[u][o-1],b=d[u][o],d[u][o-1]=w*i+b*A,d[u][o]=-w*A+b*i;for(b=g(p,y),p=(i=p/(l[o-1]=b))*v+(A=y/b)*x,w=-A*v+i*x,u=0;u<s;u++)x=f[u][o-1],b=f[u][o],f[u][o-1]=x*i+b*A,f[u][o]=-x*A+b*i}h[c]=0,h[a]=p,l[a]=w}for(o=0;o<l.length;o++)l[o]<n&&(l[o]=0);for(o=0;o<m;o++)for(u=o-1;0<=u;u--)if(l[u]<l[o]){for(i=l[u],l[u]=l[o],l[o]=i,a=0;a<f.length;a++)e=f[a][o],f[a][o]=f[a][u],f[a][u]=e;for(a=0;a<d.length;a++)e=d[a][o],d[a][o]=d[a][u],d[a][u]=e;o=u}return{U:f,S:l,V:d}}}(numeric1_2_6);var transform=function(r){if(r&&r[0]&&r[0][0]){for(var e=r.length,n=r[0].length,t=[],i=0;i<e;i++)for(var o=0;o<n;o++)t[o]||(t[o]=[]),t[o][i]=r[i][o];return t}console.error("请输入二维矩阵")},diag=function(r){var e=r.length,t=new Array(e).fill(0),i=[];return r.forEach(function(r,e){var n=_toConsumableArray(t);n[e]=r,i.push(n)}),i},dot=function(r,e){if(r[0].length!==e.length)throw new Error("矩阵不匹配，无法点乘");for(var n=r.length,t=r[0].length,i=e[0].length,o=new Array(n).fill(0).map(function(r){return new Array(i).fill(0)}),u=0;u<n;u++)for(var a=0;a<i;a++)for(var c=0;c<t;c++)o[u][a]+=r[u][c]*e[c][a];return o},d1=20,d2=6,mixRobust=function(r,e,n){return(Math.floor(r/e)+.25+.5*Number(n))*e},getUSV=function(r){for(var e=numeric1_2_6.svd(r),n=e.U,t=e.S,i=e.V,o=r.length,u=r[0].length,a=0,c=0;t.includes(NaN);){r[a][c]=Math.round(r[a][c]);var f=numeric1_2_6.svd(r),n=f.U,t=f.S,i=f.V;(function(){if(u<=++c&&(c=0,a++),o<=a)throw new Error("bad matrix case")})()}return{U:n,S:t,V:i}},encode=function(r){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=getUSV(r),t=n.U,r=n.S,n=n.V;return r[0]=mixRobust(r[0],d1,e),r[1]=mixRobust(r[1],d2,e),dot(t,dot(diag(r),transform(n)))},decode=function decode(matrix){var average=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5,avg=eval(matrix.join(",").replaceAll(",","+"))/(matrix.length*matrix[0].length);if(360<avg)return average;var _getUSV2=getUSV(matrix),S=_getUSV2.S,wm0=Number(S[0]%d1>d1/2),wm1=Number(S[1]%d2>d2/2);return(3*wm0+wm1)/4},matrixPassword={encode:encode,decode:decode},againGroup=function(){for(var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length?arguments[1]:void 0,n=[],t=0,i=_toConsumableArray(r).length;t<i;t+=e){var o=r.slice(t,t+e);o.length&&n.push(o)}return n},str2charCode=function(r){return r.split("").map(function(r){return r.charCodeAt().toString(2).padStart(16,"0")}).join("")},charCode2str=function(r){return againGroup(r,16).map(function(r){return String.fromCharCode(parseInt(r,2))}).join("")},stringCode={str2charCode:str2charCode,charCode2str:charCode2str},d=1,aabbcc="啊哈".concat(d);console.log(aabbcc);var getWmResult=function(r,e,n,t){if("bool"===e)return r;if("string"===e){var i=r.map(function(r){return Number(r)}).join("");return stringCode.charCode2str(i)}"img"===e&&(n=(e=_slicedToArray(n,2))[0],e=e[1],imgD.setTwoEnds({data:r,width:n,height:e},t))},WaterMark=function(){function WaterMark(){_classCallCheck(this,WaterMark),this.blockShape=8,this.lowChannel=[],this.heightChannel=[],this.wmBoolList=[],this.addWidth=!1,this.addHeight=!1,this.fullRowNun=0,this.fullColumnNun=0}return _createClass(WaterMark,[{key:"readImg",value:function(r){var t=this,e=imgD.getData(r);e.imgData;var n=e.width,i=e.height,o=e.R,u=e.G,r=e.B,e=e.A;this.A=e,this.width=n,this.height=i,n%2!=0&&(this.addWidth=!0,o=o.map(function(r){return r[n]=0,r}),u=u.map(function(r){return r[n]=0,r}),r=r.map(function(r){return r[n]=0,r})),i%2!=0&&(this.addHeight=!0,o[i]=new Array(n).fill(0),u[i]=new Array(n).fill(0),r[i]=new Array(n).fill(0)),[o,u,r].forEach(function(r,e){var n=_slicedToArray(privateWt.dwt(r),2),r=n[0],n=n[1];t.lowChannel[e]=r,t.heightChannel[e]=n}),this.lowChannel=this.lowChannel.map(function(r){var e=strided.strided4(r,t.blockShape),n=e.fullRowNun,r=e.fullColumnNun,e=e.result;return t.fullRowNun=n,t.fullColumnNun=r,e})}},{key:"readWm",value:function(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"bool";if(r){if("bool"===e){if(r.find(function(r){return"boolean"!=typeof r}))return void console.error("水印中存在非布尔值，请检查",r);var n=this.lowChannel.length*this.lowChannel[0].length;return r.length>n?void console.error("最多可嵌入".concat(n/1e3,"kb信息，当前信息过大约为").concat(r.length/1e3)):(this.wmBoolList=r,void(this.wmLength=r.length))}if("string"!==e){if("img"===e){var t=imgD.getTwoEnds(r),i=t.width,n=t.height,t=t.data;return this.imgWmSize=[i,n],void this.readWm(t,"bool")}console.error("水印类型错误，请输入 bool | string | img, 当前为",e)}else{e=stringCode.str2charCode(r).split("").map(function(r){return 1==r});this.readWm(e,"bool")}}else console.error("请输入水印",r)}},{key:"mixWm",value:function(r){var e,n,t,i,o,u,a=this;0!==this.wmBoolList.length&&(this.lowChannel.forEach(function(r){for(var e=0,n=0;n<a.fullRowNun;n++)for(var t=0;t<a.fullColumnNun;t++){var i=r[n][t],o=a.wmBoolList[e%a.wmLength];e++,r[n][t]=matrixPassword.encode(i,o)}}),e=(u=_slicedToArray(this.lowChannel.map(function(r,e){r=strided.spreadStrided4(r),e=privateWt.idwt(r,a.heightChannel[e]);return a.addHeight&&e.pop(),a.addWidth&&e.forEach(function(r){return r.pop()}),e}),3))[0],n=u[1],t=u[2],i=this.A,o=this.width,u=this.height,this.lowChannel=[],this.heightChannel=[],this.wmBoolList=[],this.addWidth=!1,this.addHeight=!1,imgD.setData({R:e,G:n,B:t,A:i,width:o,height:u},!0,r))}},{key:"addWm",value:function(r){var n=this,e=r.originImg,t=r.wm,i=r.wmType,r=r.name;return this.readImg(e),this.readWm(t,i),this.mixWm(r),new Promise(function(r){var e=n.wmLength;r({wmLength:e="img"===i?n.imgWmSize:e})})}},{key:"extract",value:function extract(_ref2){var _this4=this,wmImg=_ref2.wmImg,wmLength=_ref2.wmLength,wmType=_ref2.wmType,name=_ref2.name;if(wmLength)if("string"!==wmType&&"bool"!==wmType||!isNaN(Number(wmLength))){if("img"!==wmType||Array.isArray(wmLength)&&2===wmLength.length){var currentTypeWmLength="string"===wmType?16*wmLength:wmLength;"img"===wmType&&(currentTypeWmLength=wmLength[0]*wmLength[1]),this.readImg(wmImg);var passWordList=[];this.lowChannel.map(function(r){for(var e=[],n=0,t=0;t<_this4.fullRowNun;t++)for(var i=0;i<_this4.fullColumnNun;i++){var o=r[t][i],u=matrixPassword.decode(o),o=[n%currentTypeWmLength];passWordList[o]||(passWordList[o]=[]),passWordList[o].push(u),n++,e.push(u)}return e});var wmList=passWordList.map(function(arr){return.5<eval(arr.join("+"))/arr.length}),result=getWmResult(wmList,wmType,wmLength,name);return new Promise(function(r,e){r({wm:result})})}console.error("wmLength 需为数组，[width, height]",wmLength)}else console.error("wmLength 需为数字，代表水印长度",wmLength);else console.error("请输入水印长度, 水印类型为 string bool 时，wmLength 输入数字，水印类型为 img 时，wmLength 为二维数组代表图片宽高 [width, height]",wmLength)}}]),WaterMark}(),bwm=new WaterMark;module.exports=bwm;
