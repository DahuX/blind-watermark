"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _numeric=_interopRequireDefault(require("numeric")),_matrixMethods=require("./matrixMethods"),_againGroup=_interopRequireDefault(require("./againGroup"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var d1=20,d2=6,mixRobust=function(e,r,t){return(Math.floor(e/r)+.25+.5*Number(t))*r},getUSV=function(e){for(var r=_numeric.default.svd(e),t=r.U,a=r.S,u=r.V,d=e.length,i=e[0].length,o=0,n=0,m=function(){if(++n>=i&&(n=0,o++),o>=d)throw new Error("bad matrix case")};a.includes(NaN);){e[o][n]=Math.round(e[o][n]);var l=_numeric.default.svd(e);t=l.U,a=l.S,u=l.V,m()}return{U:t,S:a,V:u}},encode=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=getUSV(e),a=t.U,u=t.S,d=t.V;return u[0]=mixRobust(u[0],d1,r),u[1]=mixRobust(u[1],d2,r),(0,_matrixMethods.dot)(a,(0,_matrixMethods.dot)((0,_matrixMethods.diag)(u),(0,_matrixMethods.transform)(d)))},decode=function decode(matrix){var average=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,avg=eval(matrix.join(",").replaceAll(",","+"))/(matrix.length*matrix[0].length);if(avg>360)return average;var _getUSV2=getUSV(matrix),S=_getUSV2.S,wm0=Number(S[0]%d1>d1/2),wm1=Number(S[1]%d2>d2/2);return(3*wm0+wm1)/4},_default={encode:encode,decode:decode};exports.default=_default;